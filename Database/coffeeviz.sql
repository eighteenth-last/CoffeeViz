/*
 Navicat Premium Dump SQL

 Source Server         : WSL_MySQL
 Source Server Type    : MySQL
 Source Server Version : 80045 (8.0.45-0ubuntu0.24.04.1)
 Source Host           : 127.0.0.1:3306
 Source Schema         : coffeeviz

 Target Server Type    : MySQL
 Target Server Version : 80045 (8.0.45-0ubuntu0.24.04.1)
 File Encoding         : 65001

 Date: 11/02/2026 16:53:11
*/

SET NAMES utf8mb4;
SET FOREIGN_KEY_CHECKS = 0;

-- ----------------------------
-- Table structure for biz_diagram
-- ----------------------------
DROP TABLE IF EXISTS `biz_diagram`;
CREATE TABLE `biz_diagram`  (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '架构图ID',
  `repository_id` bigint NOT NULL COMMENT '架构库ID',
  `save_source` varchar(20) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL DEFAULT 'personal' COMMENT '保存来源: personal-个人, team-团队',
  `save_by_user_id` bigint NULL DEFAULT NULL COMMENT '保存人ID（团队成员保存时记录）',
  `diagram_name` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL COMMENT '架构图名称',
  `description` text CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL COMMENT '架构图描述',
  `source_type` varchar(20) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL COMMENT '来源类型（SQL/JDBC/AI）',
  `db_type` varchar(20) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL DEFAULT NULL COMMENT '数据库类型（mysql/postgres）',
  `mermaid_code` text CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL COMMENT 'Mermaid源码',
  `image_url` varchar(500) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL DEFAULT NULL COMMENT '图片URL（MinIO存储）',
  `table_count` int NULL DEFAULT 0 COMMENT '表数量',
  `relation_count` int NULL DEFAULT 0 COMMENT '关系数量',
  `create_time` datetime NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` datetime NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`) USING BTREE,
  INDEX `idx_repository_id`(`repository_id` ASC) USING BTREE,
  INDEX `idx_create_time`(`create_time` ASC) USING BTREE,
  CONSTRAINT `fk_diagram_repository` FOREIGN KEY (`repository_id`) REFERENCES `biz_repository` (`id`) ON DELETE CASCADE ON UPDATE RESTRICT
) ENGINE = InnoDB AUTO_INCREMENT = 14 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_unicode_ci COMMENT = '架构图表' ROW_FORMAT = DYNAMIC;

-- ----------------------------
-- Records of biz_diagram
-- ----------------------------
INSERT INTO `biz_diagram` VALUES (1, 7, 'personal', NULL, '测试', '', 'SQL', 'mysql', 'erDiagram\n    biz_diagram {\n        bigint id PK \"架构图ID\"\n        bigint repository_id FK \"NOT NULL, 架构库ID\"\n        varchar(100) diagram_name \"NOT NULL, 架构图名称\"\n        text description \"架构图描述\"\n        varchar(20) source_type \"NOT NULL, 来源类型（SQL/JDBC/AI）\"\n        varchar(20) db_type \"数据库类型（mysql/postgres）\"\n        text mermaid_code \"Mermaid源码\"\n        varchar(500) image_url \"图片URL（MinIO存储）\"\n        int table_count \"表数量\"\n        int relation_count \"关系数量\"\n        datetime create_time \"创建时间\"\n        datetime update_time \"更新时间\"\n    }\n    biz_repository {\n        bigint id PK \"项目ID\"\n        bigint user_id FK \"NOT NULL, 用户ID\"\n        varchar(100) repository_name \"NOT NULL, 架构库名称\"\n        text description \"项目描述\"\n        int diagram_count \"架构图数量\"\n        varchar(20) status \"状态（DRAFT/PUBLISHED）\"\n        datetime create_time \"创建时间\"\n        datetime update_time \"更新时间\"\n    }\n    biz_repository_config {\n        bigint id PK \"配置ID\"\n        bigint repository_id FK \"NOT NULL, 架构库ID\"\n        varchar(20) config_type \"NOT NULL, 配置类型（SQL/JDBC）\"\n        mediumtext sql_content \"SQL内容\"\n        varchar(500) jdbc_url \"JDBC URL\"\n        varchar(100) jdbc_username \"数据库用户名\"\n        varchar(255) jdbc_password \"数据库密码（AES加密）\"\n        varchar(100) schema_name \"Schema名称\"\n        json render_options \"渲染选项（JSON格式）\"\n        datetime create_time \"创建时间\"\n    }\n    sys_config {\n        bigint id PK \"配置ID\"\n        varchar(100) config_key \"NOT NULL, 配置键（唯一）\"\n        text config_value \"配置值\"\n        varchar(500) description \"描述\"\n        datetime create_time \"创建时间\"\n        datetime update_time \"更新时间\"\n    }\n    sys_user {\n        bigint id PK \"用户ID\"\n        varchar(50) username \"NOT NULL, 用户名（唯一）\"\n        varchar(255) password \"NOT NULL, 密码（BCrypt加密）\"\n        varchar(100) email \"邮箱\"\n        varchar(20) phone \"手机号\"\n        varchar(50) display_name \"显示名称\"\n        varchar(50) job_title \"职位头衔\"\n        varchar(500) avatar_url \"头像URL\"\n        tinyint status \"状态（1=正常，0=禁用）\"\n        datetime create_time \"创建时间\"\n        datetime update_time \"更新时间\"\n    }\n    biz_repository ||--o{ biz_diagram : \"repository_id\"\n    sys_user ||--o{ biz_repository : \"user_id\"\n    biz_repository ||--o{ biz_repository_config : \"repository_id\"\n', 'http://localhost:8080/api/image/diagrams/7/1770528744064_测试.png', 5, 3, '2026-02-08 13:32:24', '2026-02-08 13:32:24');
INSERT INTO `biz_diagram` VALUES (4, 7, 'personal', NULL, 'coffeeviz', '', 'SQL', 'mysql', 'erDiagram\n    biz_diagram {\n        BIGINT(19) id PK \"架构图ID\"\n        BIGINT(19) repository_id FK \"NOT NULL, 架构库ID\"\n        VARCHAR(20) save_source \"保存来源: personal-个人, team-团队\"\n        BIGINT(19) save_by_user_id \"保存人ID（团队成员保存时记录）\"\n        VARCHAR(100) diagram_name \"NOT NULL, 架构图名称\"\n        TEXT(65535) description \"架构图描述\"\n        VARCHAR(20) source_type \"NOT NULL, 来源类型（SQL/JDBC/AI）\"\n        VARCHAR(20) db_type \"数据库类型（mysql/postgres）\"\n        TEXT(65535) mermaid_code \"Mermaid源码\"\n        VARCHAR(500) image_url \"图片URL（MinIO存储）\"\n        INT(10) table_count \"表数量\"\n        INT(10) relation_count \"关系数量\"\n        DATETIME(19) create_time \"创建时间\"\n        DATETIME(19) update_time \"更新时间\"\n    }\n    biz_payment_order {\n        BIGINT(19) id PK \"订单ID\"\n        VARCHAR(50) order_no \"NOT NULL, 订单号\"\n        BIGINT(19) user_id FK \"NOT NULL, 用户ID\"\n        BIGINT(19) subscription_id \"订阅ID\"\n        BIGINT(19) plan_id \"NOT NULL, 计划ID\"\n        VARCHAR(50) plan_code \"NOT NULL, 计划代码\"\n        VARCHAR(20) billing_cycle \"计费周期\"\n        DECIMAL(10_2) amount \"NOT NULL, 订单金额\"\n        VARCHAR(10) currency \"货币类型\"\n        VARCHAR(50) payment_method \"支付方式\"\n        VARCHAR(20) payment_status \"支付状态（pending/paid/failed/refunded）\"\n        VARCHAR(100) transaction_id \"第三方交易ID\"\n        DATETIME(19) payment_time \"支付时间\"\n        DATETIME(19) refund_time \"退款时间\"\n        TEXT(65535) refund_reason \"退款原因\"\n        TEXT(65535) remark \"备注\"\n        DATETIME(19) create_time \"创建时间\"\n        DATETIME(19) update_time \"更新时间\"\n    }\n    biz_plan_quota {\n        BIGINT(19) id PK \"配额ID\"\n        BIGINT(19) plan_id FK \"NOT NULL, 订阅计划ID\"\n        VARCHAR(50) quota_type \"NOT NULL, 配额类型（repository/diagram/sql_parse/ai_generate）\"\n        INT(10) quota_limit \"NOT NULL, 配额限制（-1表示无限制）\"\n        VARCHAR(20) reset_cycle \"重置周期（daily/monthly/yearly/never）\"\n        TEXT(65535) description \"配额描述\"\n        DATETIME(19) create_time \"创建时间\"\n        DATETIME(19) update_time \"更新时间\"\n    }\n    biz_project_config {\n        BIGINT(19) id PK \"配置ID\"\n        BIGINT(19) project_id \"NOT NULL, 项目ID\"\n        VARCHAR(20) config_type \"NOT NULL, 配置类型（SQL/JDBC）\"\n        MEDIUMTEXT(16777215) sql_content \"SQL内容\"\n        VARCHAR(500) jdbc_url \"JDBC URL\"\n        VARCHAR(100) jdbc_username \"数据库用户名\"\n        VARCHAR(255) jdbc_password \"数据库密码（AES加密）\"\n        VARCHAR(100) schema_name \"Schema名称\"\n        JSON(1073741824) render_options \"渲染选项（JSON格式）\"\n        DATETIME(19) create_time \"创建时间\"\n    }\n    biz_project_version {\n        BIGINT(19) id PK \"版本ID\"\n        BIGINT(19) project_id \"NOT NULL, 项目ID\"\n        INT(10) version_no \"NOT NULL, 版本号\"\n        TEXT(65535) mermaid_code \"Mermaid源码\"\n        TEXT(65535) change_log \"变更日志\"\n        DATETIME(19) create_time \"创建时间\"\n    }\n    biz_repository {\n        BIGINT(19) id PK \"项目ID\"\n        BIGINT(19) user_id FK \"NOT NULL, 用户ID\"\n        VARCHAR(100) repository_name \"NOT NULL, 架构库名称\"\n        TEXT(65535) description \"项目描述\"\n        INT(10) diagram_count \"架构图数量\"\n        VARCHAR(20) status \"状态（DRAFT/PUBLISHED）\"\n        BIT(1) is_team_repository \"是否为团队归档库\"\n        DATETIME(19) create_time \"创建时间\"\n        DATETIME(19) update_time \"更新时间\"\n    }\n    biz_subscription_plan {\n        BIGINT(19) id PK \"计划ID\"\n        VARCHAR(50) plan_code \"NOT NULL, 计划代码（FREE/PRO/TEAM）\"\n        VARCHAR(100) plan_name \"NOT NULL, 计划名称\"\n        VARCHAR(100) plan_name_en \"计划英文名称\"\n        TEXT(65535) description \"计划描述\"\n        DECIMAL(10_2) price_monthly \"月付价格\"\n        DECIMAL(10_2) price_yearly \"年付价格\"\n        INT(10) max_repositories \"最大架构库数量（-1表示无限制）\"\n        INT(10) max_diagrams_per_repo \"每个库最大架构图数量（-1表示无限制）\"\n        INT(10) max_sql_size_mb \"最大SQL文件大小（MB）\"\n        TINYINT(3) support_jdbc \"是否支持JDBC连接（0=否，1=是）\"\n        TINYINT(3) support_ai \"是否支持AI功能（0=否，1=是）\"\n        TINYINT(3) support_export \"是否支持导出（0=否，1=是）\"\n        TINYINT(3) support_team \"是否支持团队协作（0=否，1=是）\"\n        INT(10) max_teams \"最大团队数量\"\n        INT(10) max_team_members \"每个团队最大成员数\"\n        TINYINT(3) priority_support \"是否优先支持（0=否，1=是）\"\n        JSON(1073741824) features \"功能特性列表（JSON格式）\"\n        INT(10) sort_order \"排序顺序\"\n        VARCHAR(20) status \"状态（active/inactive）\"\n        DATETIME(19) create_time \"创建时间\"\n        DATETIME(19) update_time \"更新时间\"\n    }\n    biz_team {\n        BIGINT(19) id PK \"团队ID\"\n        VARCHAR(100) team_name \"NOT NULL, 团队名称\"\n        VARCHAR(50) team_code \"NOT NULL, 团队唯一标识\"\n        TEXT(65535) description \"团队描述\"\n        VARCHAR(500) avatar_url \"团队头像\"\n        BIGINT(19) owner_id \"NOT NULL, 所有者ID\"\n        BIGINT(19) repository_id \"NOT NULL, 绑定的架构归档库ID\"\n        INT(10) member_count \"成员数量\"\n        INT(10) max_members \"最大成员数（根据订阅套餐）\"\n        VARCHAR(20) status \"状态: active-活跃, suspended-暂停, deleted-已删除\"\n        DATETIME(19) create_time \"创建时间\"\n        DATETIME(19) update_time \"更新时间\"\n    }\n    biz_team_invitation {\n        BIGINT(19) id PK \"邀请ID\"\n        BIGINT(19) team_id \"NOT NULL, 团队ID\"\n        VARCHAR(50) invite_code \"NOT NULL, 邀请码（UUID）\"\n        VARCHAR(500) invite_url \"NOT NULL, 完整邀请链接\"\n        BIGINT(19) creator_id \"NOT NULL, 创建人ID\"\n        INT(10) max_uses \"最大使用次数（0=无限制）\"\n        INT(10) used_count \"已使用次数\"\n        VARCHAR(20) status \"状态: active-有效, disabled-禁用, expired-已过期\"\n        DATETIME(19) expire_time \"过期时间（NULL=永久有效）\"\n        DATETIME(19) create_time \"创建时间\"\n        DATETIME(19) update_time \"更新时间\"\n    }\n    biz_team_invitation_log {\n        BIGINT(19) id PK \"记录ID\"\n        BIGINT(19) team_id \"NOT NULL, 团队ID\"\n        VARCHAR(50) invite_code \"NOT NULL, 邀请码\"\n        BIGINT(19) user_id \"NOT NULL, 加入用户ID\"\n        VARCHAR(50) username \"用户名\"\n        VARCHAR(100) email \"邮箱\"\n        BIT(1) is_new_user \"是否新注册用户\"\n        DATETIME(19) join_time \"加入时间\"\n        VARCHAR(50) ip_address \"IP地址\"\n        VARCHAR(500) user_agent \"用户代理\"\n    }\n    biz_team_log {\n        BIGINT(19) id PK \"日志ID\"\n        BIGINT(19) team_id \"NOT NULL, 团队ID\"\n        BIGINT(19) user_id \"NOT NULL, 操作人ID\"\n        VARCHAR(50) action \"NOT NULL, 操作类型\"\n        VARCHAR(50) target_type \"目标类型: member-成员, diagram-架构图, team-团队\"\n        BIGINT(19) target_id \"目标ID\"\n        TEXT(65535) description \"操作描述\"\n        VARCHAR(50) ip_address \"IP地址\"\n        VARCHAR(500) user_agent \"用户代理\"\n        DATETIME(19) create_time \"创建时间\"\n    }\n    biz_team_member {\n        BIGINT(19) id PK \"成员ID\"\n        BIGINT(19) team_id \"NOT NULL, 团队ID\"\n        BIGINT(19) user_id \"NOT NULL, 用户ID\"\n        VARCHAR(20) role \"NOT NULL, 角色: owner-所有者, member-成员\"\n        VARCHAR(50) nickname \"团队内昵称\"\n        DATETIME(19) join_time \"加入时间\"\n        VARCHAR(20) join_source \"加入方式: create-创建, invite-邀请\"\n        VARCHAR(50) invite_code \"使用的邀请码\"\n        VARCHAR(20) status \"状态: active-活跃, inactive-停用\"\n        DATETIME(19) create_time \"创建时间\"\n        DATETIME(19) update_time \"更新时间\"\n    }\n    biz_user_quota_tracking {\n        BIGINT(19) id PK \"跟踪ID\"\n        BIGINT(19) user_id FK \"NOT NULL, 用户ID\"\n        BIGINT(19) plan_quota_id FK \"NOT NULL, 计划配额ID\"\n        VARCHAR(50) quota_type \"NOT NULL, 配额类型\"\n        INT(10) quota_limit \"NOT NULL, 当前配额限制\"\n        INT(10) quota_used \"已使用配额\"\n        DATETIME(19) last_reset_time \"上次重置时间\"\n        DATETIME(19) create_time \"创建时间\"\n        DATETIME(19) update_time \"更新时间\"\n    }\n    biz_user_subscription {\n        BIGINT(19) id PK \"订阅ID\"\n        BIGINT(19) user_id FK \"NOT NULL, 用户ID\"\n        BIGINT(19) plan_id FK \"NOT NULL, 计划ID\"\n        VARCHAR(50) plan_code \"NOT NULL, 计划代码\"\n        BIGINT(19) payment_order_id FK \"支付订单ID\"\n        VARCHAR(20) billing_cycle \"计费周期（monthly/yearly）\"\n        DECIMAL(10_2) price \"订阅价格\"\n        DATETIME(19) start_time \"NOT NULL, 开始时间\"\n        DATETIME(19) end_time \"NOT NULL, 结束时间\"\n        TINYINT(3) auto_renew \"是否自动续费（0=否，1=是）\"\n        VARCHAR(20) status \"状态（active/expired/cancelled）\"\n        VARCHAR(50) payment_method \"支付方式（wechat/alipay/stripe）\"\n        VARCHAR(100) transaction_id \"交易ID\"\n        DATETIME(19) cancel_time \"取消时间\"\n        TEXT(65535) cancel_reason \"取消原因\"\n        DATETIME(19) create_time \"创建时间\"\n        DATETIME(19) update_time \"更新时间\"\n    }\n    sys_config {\n        BIGINT(19) id PK \"配置ID\"\n        VARCHAR(100) config_key \"NOT NULL, 配置键（唯一）\"\n        TEXT(65535) config_value \"配置值\"\n        VARCHAR(500) description \"描述\"\n        DATETIME(19) create_time \"创建时间\"\n        DATETIME(19) update_time \"更新时间\"\n    }\n    sys_user {\n        BIGINT(19) id PK \"用户ID\"\n        VARCHAR(50) username \"NOT NULL, 用户名（唯一）\"\n        VARCHAR(255) password \"NOT NULL, 密码（BCrypt加密）\"\n        VARCHAR(100) email \"邮箱\"\n        VARCHAR(20) phone \"手机号\"\n        VARCHAR(50) display_name \"显示名称\"\n        VARCHAR(50) job_title \"职位头衔\"\n        VARCHAR(500) avatar_url \"头像URL\"\n        TINYINT(3) status \"状态（1=正常，0=禁用）\"\n        DATETIME(19) create_time \"创建时间\"\n        DATETIME(19) update_time \"更新时间\"\n    }\n    biz_repository ||--o{ biz_diagram : \"repository_id\"\n    sys_user ||--o{ biz_payment_order : \"user_id\"\n    biz_subscription_plan ||--o{ biz_plan_quota : \"plan_id\"\n    sys_user ||--o{ biz_repository : \"user_id\"\n    sys_user ||--o{ biz_user_quota_tracking : \"user_id\"\n    biz_plan_quota ||--o{ biz_user_quota_tracking : \"plan_quota_id\"\n    biz_payment_order ||--o{ biz_user_subscription : \"payment_order_id\"\n    biz_subscription_plan ||--o{ biz_user_subscription : \"plan_id\"\n    sys_user ||--o{ biz_user_subscription : \"user_id\"\n', 'http://localhost:8080/api/image/diagrams/7/1770721176377_coffeeviz.png', 16, 9, '2026-02-10 18:59:36', '2026-02-10 18:59:36');
INSERT INTO `biz_diagram` VALUES (5, 20, 'personal', NULL, '项目管理系统', '', 'AI', 'mysql', 'erDiagram\n    workspace {\n        BIGINT id PK \"主键ID\"\n        VARCHAR(100) name \"NOT NULL, 工作空间名称\"\n        TEXT description \"工作空间描述\"\n        BIGINT owner_id \"NOT NULL, 创建者用户ID（外部系统用户）\"\n        VARCHAR(500) avatar_url \"头像URL\"\n        TINYINT(1) is_archived \"NOT NULL, 是否归档：0-否，1-是\"\n        DATETIME created_at \"NOT NULL, 创建时间\"\n        DATETIME updated_at \"NOT NULL, 更新时间\"\n    }\n    member {\n        BIGINT id PK \"主键ID\"\n        BIGINT workspace_id FK \"NOT NULL, 所属工作空间ID\"\n        BIGINT user_id \"NOT NULL, 用户ID（外部系统用户）\"\n        VARCHAR(50) nickname \"在工作空间中的昵称\"\n        ENUM role \"NOT NULL, 角色：owner-所有者，admin-管理员，member-普通成员\"\n        DATETIME joined_at \"NOT NULL, 加入时间\"\n        TINYINT(1) is_active \"NOT NULL, 是否有效：0-已移除，1-有效\"\n        DATETIME created_at \"NOT NULL, 创建时间\"\n        DATETIME updated_at \"NOT NULL, 更新时间\"\n    }\n    project {\n        BIGINT id PK \"主键ID\"\n        BIGINT workspace_id FK \"NOT NULL, 所属工作空间ID\"\n        VARCHAR(100) name \"NOT NULL, 项目名称\"\n        TEXT description \"项目描述\"\n        VARCHAR(500) cover_url \"封面图片URL\"\n        DATE start_date \"计划开始日期\"\n        DATE end_date \"计划结束日期\"\n        ENUM status \"NOT NULL, 状态\"\n        ENUM visibility \"NOT NULL, 可见性\"\n        INT sort_order \"NOT NULL, 排序权重\"\n        BIGINT created_by FK \"NOT NULL, 创建者成员ID\"\n        DATETIME created_at \"NOT NULL, 创建时间\"\n        DATETIME updated_at \"NOT NULL, 更新时间\"\n    }\n    project_member {\n        BIGINT id PK \"主键ID\"\n        BIGINT project_id FK \"NOT NULL, 项目ID\"\n        BIGINT member_id FK \"NOT NULL, 成员ID\"\n        ENUM role \"NOT NULL, 项目内角色\"\n        DATETIME joined_at \"NOT NULL, 加入时间\"\n        DATETIME created_at \"NOT NULL, 创建时间\"\n    }\n    board {\n        BIGINT id PK \"主键ID\"\n        BIGINT project_id FK \"NOT NULL, 所属项目ID\"\n        VARCHAR(100) name \"NOT NULL, 看板名称\"\n        TEXT description \"看板描述\"\n        ENUM layout_type \"NOT NULL, 布局类型\"\n        TINYINT(1) is_default \"NOT NULL, 是否为默认看板\"\n        INT sort_order \"NOT NULL, 排序权重\"\n        JSON filter_config \"筛选配置（JSON格式）\"\n        BIGINT created_by FK \"NOT NULL, 创建者成员ID\"\n        DATETIME created_at \"NOT NULL, 创建时间\"\n        DATETIME updated_at \"NOT NULL, 更新时间\"\n    }\n    list {\n        BIGINT id PK \"主键ID\"\n        BIGINT board_id FK \"NOT NULL, 所属看板ID\"\n        VARCHAR(100) name \"NOT NULL, 列表名称\"\n        VARCHAR(20) color \"颜色标识\"\n        INT wip_limit \"在制品限制（Work In Progress Limit）\"\n        TINYINT(1) is_archive_list \"NOT NULL, 是否为归档列表\"\n        INT sort_order \"NOT NULL, 排序权重\"\n        DATETIME created_at \"NOT NULL, 创建时间\"\n        DATETIME updated_at \"NOT NULL, 更新时间\"\n    }\n    workspace ||--o{ member : \"workspace_id\"\n    workspace ||--o{ project : \"workspace_id\"\n    member ||--o{ project : \"created_by\"\n    project ||--o{ project_member : \"project_id\"\n    member ||--o{ project_member : \"member_id\"\n    project ||--o{ board : \"project_id\"\n    member ||--o{ board : \"created_by\"\n    board ||--o{ list : \"board_id\"', 'http://localhost:8080/api/image/projects/1770722429017_项目管理系统.png', 0, 0, '2026-02-10 19:20:29', '2026-02-10 19:20:29');
INSERT INTO `biz_diagram` VALUES (6, 20, 'personal', NULL, '测试', '', 'AI', 'mysql', 'erDiagram\n    workspace {\n        BIGINT id PK \"主键ID\"\n        VARCHAR(100) name \"NOT NULL, 工作空间名称\"\n        TEXT description \"工作空间描述\"\n        BIGINT owner_id \"NOT NULL, 创建者用户ID（外部系统用户）\"\n        VARCHAR(500) avatar_url \"头像URL\"\n        TINYINT(1) is_archived \"NOT NULL, 是否归档：0-否，1-是\"\n        DATETIME created_at \"NOT NULL, 创建时间\"\n        DATETIME updated_at \"NOT NULL, 更新时间\"\n    }\n    member {\n        BIGINT id PK \"主键ID\"\n        BIGINT workspace_id FK \"NOT NULL, 所属工作空间ID\"\n        BIGINT user_id \"NOT NULL, 用户ID（外部系统用户）\"\n        VARCHAR(50) nickname \"在工作空间中的昵称\"\n        ENUM role \"NOT NULL, 角色：owner-所有者，admin-管理员，member-普通成员\"\n        DATETIME joined_at \"NOT NULL, 加入时间\"\n        TINYINT(1) is_active \"NOT NULL, 是否有效：0-已移除，1-有效\"\n        DATETIME created_at \"NOT NULL, 创建时间\"\n        DATETIME updated_at \"NOT NULL, 更新时间\"\n    }\n    project {\n        BIGINT id PK \"主键ID\"\n        BIGINT workspace_id FK \"NOT NULL, 所属工作空间ID\"\n        VARCHAR(100) name \"NOT NULL, 项目名称\"\n        TEXT description \"项目描述\"\n        VARCHAR(500) cover_url \"封面图片URL\"\n        DATE start_date \"计划开始日期\"\n        DATE end_date \"计划结束日期\"\n        ENUM status \"NOT NULL, 状态\"\n        ENUM visibility \"NOT NULL, 可见性\"\n        INT sort_order \"NOT NULL, 排序权重\"\n        BIGINT created_by FK \"NOT NULL, 创建者成员ID\"\n        DATETIME created_at \"NOT NULL, 创建时间\"\n        DATETIME updated_at \"NOT NULL, 更新时间\"\n    }\n    project_member {\n        BIGINT id PK \"主键ID\"\n        BIGINT project_id FK \"NOT NULL, 项目ID\"\n        BIGINT member_id FK \"NOT NULL, 成员ID\"\n        ENUM role \"NOT NULL, 项目内角色\"\n        DATETIME joined_at \"NOT NULL, 加入时间\"\n        DATETIME created_at \"NOT NULL, 创建时间\"\n    }\n    board {\n        BIGINT id PK \"主键ID\"\n        BIGINT project_id FK \"NOT NULL, 所属项目ID\"\n        VARCHAR(100) name \"NOT NULL, 看板名称\"\n        TEXT description \"看板描述\"\n        ENUM layout_type \"NOT NULL, 布局类型\"\n        TINYINT(1) is_default \"NOT NULL, 是否为默认看板\"\n        INT sort_order \"NOT NULL, 排序权重\"\n        JSON filter_config \"筛选配置（JSON格式）\"\n        BIGINT created_by FK \"NOT NULL, 创建者成员ID\"\n        DATETIME created_at \"NOT NULL, 创建时间\"\n        DATETIME updated_at \"NOT NULL, 更新时间\"\n    }\n    list {\n        BIGINT id PK \"主键ID\"\n        BIGINT board_id FK \"NOT NULL, 所属看板ID\"\n        VARCHAR(100) name \"NOT NULL, 列表名称\"\n        VARCHAR(20) color \"颜色标识\"\n        INT wip_limit \"在制品限制（Work In Progress Limit）\"\n        TINYINT(1) is_archive_list \"NOT NULL, 是否为归档列表\"\n        INT sort_order \"NOT NULL, 排序权重\"\n        DATETIME created_at \"NOT NULL, 创建时间\"\n        DATETIME updated_at \"NOT NULL, 更新时间\"\n    }\n    workspace ||--o{ member : \"workspace_id\"\n    workspace ||--o{ project : \"workspace_id\"\n    member ||--o{ project : \"created_by\"\n    project ||--o{ project_member : \"project_id\"\n    member ||--o{ project_member : \"member_id\"\n    project ||--o{ board : \"project_id\"\n    member ||--o{ board : \"created_by\"\n    board ||--o{ list : \"board_id\"', 'http://localhost:8080/api/image/diagrams/20/1770723410736_测试.png', 0, 0, '2026-02-10 19:36:51', '2026-02-10 19:36:51');
INSERT INTO `biz_diagram` VALUES (7, 20, 'personal', NULL, 'ddd', '', 'AI', 'mysql', 'erDiagram\n    user {\n        BIGINT id PK \"用户ID\"\n        VARCHAR(50) username \"NOT NULL, 用户名\"\n        VARCHAR(100) email \"NOT NULL, 邮箱\"\n        VARCHAR(255) password_hash \"NOT NULL, 密码哈希\"\n        VARCHAR(50) nickname \"昵称\"\n        VARCHAR(500) avatar_url \"头像URL\"\n        TEXT bio \"个人简介\"\n        TINYINT role \"NOT NULL, 角色：0-管理员, 1-作者, 2-读者\"\n        TINYINT status \"NOT NULL, 状态：0-禁用, 1-正常\"\n        DATETIME created_at \"NOT NULL, 创建时间\"\n        DATETIME updated_at \"NOT NULL, 更新时间\"\n        DATETIME last_login_at \"最后登录时间\"\n    }\n    category {\n        INT id PK \"分类ID\"\n        INT parent_id FK \"父分类ID，NULL为顶级分类\"\n        VARCHAR(50) name \"NOT NULL, 分类名称\"\n        VARCHAR(50) slug \"NOT NULL, URL友好标识\"\n        VARCHAR(255) description \"分类描述\"\n        INT sort_order \"NOT NULL, 排序权重\"\n        DATETIME created_at \"NOT NULL\"\n    }\n    tag {\n        INT id PK \"标签ID\"\n        VARCHAR(30) name \"NOT NULL, 标签名称\"\n        VARCHAR(30) slug \"NOT NULL, URL友好标识\"\n        INT usage_count \"NOT NULL, 使用次数统计\"\n        DATETIME created_at \"NOT NULL\"\n    }\n    post {\n        BIGINT id PK \"文章ID\"\n        BIGINT author_id FK \"NOT NULL, 作者用户ID\"\n        INT category_id FK \"所属分类ID\"\n        VARCHAR(200) title \"NOT NULL, 文章标题\"\n        VARCHAR(200) slug \"NOT NULL, URL友好标识\"\n        VARCHAR(500) summary \"摘要\"\n        LONGTEXT content \"NOT NULL, 正文内容（Markdown/HTML）\"\n        VARCHAR(500) cover_image \"封面图URL\"\n        INT view_count \"NOT NULL, 浏览次数\"\n        INT like_count \"NOT NULL, 点赞次数\"\n        INT comment_count \"NOT NULL, 评论数统计（冗余字段）\"\n        TINYINT status \"NOT NULL, 状态：0-草稿, 1-已发布, 2-私密, 3-回收站\"\n        TINYINT(1) is_top \"NOT NULL, 是否置顶\"\n        DATETIME published_at \"发布时间\"\n        DATETIME created_at \"NOT NULL\"\n        DATETIME updated_at \"NOT NULL\"\n        DATETIME deleted_at \"软删除时间\"\n    }\n    post_tag {\n        BIGINT post_id PK \"文章ID\"\n        INT tag_id PK \"标签ID\"\n        DATETIME created_at \"NOT NULL\"\n    }\n    comment {\n        BIGINT id PK \"评论ID\"\n        BIGINT post_id FK \"NOT NULL, 所属文章ID\"\n        BIGINT parent_comment_id FK \"父评论ID，NULL为一级评论\"\n        BIGINT user_id FK \"注册用户ID，NULL为匿名评论\"\n        VARCHAR(50) visitor_name \"访客昵称（未登录时）\"\n        VARCHAR(100) visitor_email \"访客邮箱（未登录时）\"\n        VARCHAR(200) visitor_website \"访客网站（未登录时）\"\n        TEXT content \"NOT NULL, 评论内容\"\n        INT like_count \"NOT NULL, 点赞数\"\n        TINYINT status \"NOT NULL, 状态：0-待审核, 1-已通过, 2-已拒绝, 3-已删除\"\n        VARCHAR(45) ip_address \"评论者IP\"\n        VARCHAR(500) user_agent \"浏览器UA\"\n        DATETIME created_at \"NOT NULL\"\n        DATETIME updated_at \"NOT NULL\"\n    }\n    category ||--o{ category : \"parent_id\"\n    user ||--o{ post : \"author_id\"\n    category ||--o{ post : \"category_id\"\n    post ||--o{ post_tag : \"post_id\"\n    tag ||--o{ post_tag : \"tag_id\"\n    post ||--o{ comment : \"post_id\"\n    comment ||--o{ comment : \"parent_comment_id\"\n    user ||--o{ comment : \"user_id\"', 'http://localhost:8080/api/image/diagrams/20/1770723890278_ddd.png', 6, 8, '2026-02-10 19:44:50', '2026-02-10 19:44:50');
INSERT INTO `biz_diagram` VALUES (8, 7, 'personal', NULL, '测试', '', 'AI', 'mysql', 'erDiagram\n    user {\n        BIGINT id PK \"用户ID\"\n        VARCHAR(255) email \"NOT NULL, 邮箱（登录账号）\"\n        VARCHAR(255) password_hash \"NOT NULL, 密码哈希\"\n        VARCHAR(64) nickname \"NOT NULL, 昵称\"\n        VARCHAR(500) avatar_url \"头像URL\"\n        VARCHAR(20) phone \"手机号\"\n        TINYINT status \"NOT NULL, 状态：0-禁用，1-启用\"\n        DATETIME last_login_at \"最后登录时间\"\n        DATETIME created_at \"NOT NULL, 创建时间\"\n        DATETIME updated_at \"NOT NULL, 更新时间\"\n    }\n    workspace {\n        BIGINT id PK \"工作空间ID\"\n        VARCHAR(128) name \"NOT NULL, 工作空间名称\"\n        TEXT description \"描述\"\n        BIGINT owner_id FK \"NOT NULL, 所有者用户ID\"\n        VARCHAR(500) logo_url \"Logo URL\"\n        TINYINT status \"NOT NULL, 状态：0-归档，1-活跃\"\n        DATETIME created_at \"NOT NULL, 创建时间\"\n        DATETIME updated_at \"NOT NULL, 更新时间\"\n    }\n    workspace_member {\n        BIGINT id PK \"记录ID\"\n        BIGINT workspace_id FK \"NOT NULL, 工作空间ID\"\n        BIGINT user_id FK \"NOT NULL, 用户ID\"\n        ENUM role \"NOT NULL, 角色：所有者/管理员/成员/访客\"\n        DATETIME joined_at \"NOT NULL, 加入时间\"\n        DATETIME created_at \"NOT NULL, 创建时间\"\n        DATETIME updated_at \"NOT NULL, 更新时间\"\n    }\n    project {\n        BIGINT id PK \"项目ID\"\n        BIGINT workspace_id FK \"NOT NULL, 所属工作空间ID\"\n        VARCHAR(128) name \"NOT NULL, 项目名称\"\n        TEXT description \"项目描述\"\n        VARCHAR(7) color \"主题色（十六进制）\"\n        VARCHAR(500) cover_image_url \"封面图URL\"\n        DATE start_date \"计划开始日期\"\n        DATE end_date \"计划结束日期\"\n        ENUM visibility \"NOT NULL, 可见性：私有/工作空间内/公开\"\n        ENUM status \"NOT NULL, 状态\"\n        BIGINT created_by FK \"NOT NULL, 创建人ID\"\n        DATETIME created_at \"NOT NULL, 创建时间\"\n        DATETIME updated_at \"NOT NULL, 更新时间\"\n    }\n    board {\n        BIGINT id PK \"看板ID\"\n        BIGINT project_id FK \"NOT NULL, 所属项目ID\"\n        VARCHAR(128) name \"NOT NULL, 看板名称\"\n        TEXT description \"看板描述\"\n        ENUM type \"NOT NULL, 看板类型\"\n        INT sort_order \"NOT NULL, 排序序号\"\n        TINYINT(1) is_default \"NOT NULL, 是否为默认看板\"\n        JSON config_json \"看板配置（列宽、筛选条件等）\"\n        BIGINT created_by FK \"NOT NULL, 创建人ID\"\n        DATETIME created_at \"NOT NULL, 创建时间\"\n        DATETIME updated_at \"NOT NULL, 更新时间\"\n    }\n    list {\n        BIGINT id PK \"列表ID\"\n        BIGINT board_id FK \"NOT NULL, 所属看板ID\"\n        VARCHAR(128) name \"NOT NULL, 列表名称\"\n        VARCHAR(7) color \"颜色标识\"\n        INT sort_order \"NOT NULL, 在看板中的排序\"\n        INT wip_limit \"在制品限制（Work In Progress Limit）\"\n        TINYINT(1) is_archive_list \"NOT NULL, 是否为归档列表\"\n        DATETIME created_at \"NOT NULL, 创建时间\"\n        DATETIME updated_at \"NOT NULL, 更新时间\"\n    }\n    user ||--o{ workspace : \"owner_id\"\n    workspace ||--o{ workspace_member : \"workspace_id\"\n    user ||--o{ workspace_member : \"user_id\"\n    workspace ||--o{ project : \"workspace_id\"\n    user ||--o{ project : \"created_by\"\n    project ||--o{ board : \"project_id\"\n    user ||--o{ board : \"created_by\"\n    board ||--o{ list : \"board_id\"', 'http://localhost:8080/api/image/diagrams/7/1770792329764_测试.png', 0, 0, '2026-02-11 14:45:30', '2026-02-11 14:45:30');
INSERT INTO `biz_diagram` VALUES (9, 7, 'personal', NULL, 'gfgfz ', '', 'AI', 'mysql', 'erDiagram\n    user {\n        BIGINT id PK \"用户ID，主键\"\n        VARCHAR(50) username \"NOT NULL, 用户名，登录账号\"\n        VARCHAR(100) email \"NOT NULL, 邮箱地址\"\n        VARCHAR(255) password_hash \"NOT NULL, 密码哈希值(BCrypt)\"\n        VARCHAR(50) nickname \"显示昵称\"\n        VARCHAR(500) avatar_url \"头像URL地址\"\n        TEXT bio \"个人简介\"\n        TINYINT role \"NOT NULL, 角色: 1=管理员, 2=作者, 3=读者\"\n        TINYINT status \"NOT NULL, 状态: 0=禁用, 1=正常\"\n        DATETIME last_login_at \"最后登录时间\"\n        DATETIME created_at \"NOT NULL, 创建时间\"\n        DATETIME updated_at \"NOT NULL, 更新时间\"\n        DATETIME deleted_at \"软删除时间\"\n    }\n    category {\n        INT id PK \"分类ID，主键\"\n        INT parent_id FK \"父分类ID，NULL为顶级分类\"\n        VARCHAR(50) name \"NOT NULL, 分类名称\"\n        VARCHAR(50) slug \"NOT NULL, URL友好标识\"\n        VARCHAR(255) description \"分类描述\"\n        INT sort_order \"NOT NULL, 排序权重，越小越靠前\"\n        TINYINT is_visible \"NOT NULL, 是否可见: 0=隐藏, 1=显示\"\n        DATETIME created_at \"NOT NULL\"\n        DATETIME updated_at \"NOT NULL\"\n    }\n    tag {\n        INT id PK \"标签ID，主键\"\n        VARCHAR(30) name \"NOT NULL, 标签名称\"\n        VARCHAR(30) slug \"NOT NULL, URL友好标识\"\n        INT usage_count \"NOT NULL, 使用次数统计\"\n        DATETIME created_at \"NOT NULL\"\n    }\n    post {\n        BIGINT id PK \"文章ID，主键\"\n        BIGINT author_id FK \"NOT NULL, 作者用户ID\"\n        INT category_id FK \"所属分类ID\"\n        VARCHAR(200) title \"NOT NULL, 文章标题\"\n        VARCHAR(200) slug \"NOT NULL, URL友好标识\"\n        VARCHAR(500) summary \"文章摘要\"\n        LONGTEXT content \"NOT NULL, 文章内容(Markdown/HTML)\"\n        VARCHAR(500) cover_image \"封面图片URL\"\n        TINYINT status \"NOT NULL, 状态: 0=草稿, 1=已发布, 2=归档\"\n        TINYINT is_top \"NOT NULL, 是否置顶: 0=否, 1=是\"\n        INT view_count \"NOT NULL, 浏览次数\"\n        INT like_count \"NOT NULL, 点赞次数\"\n        INT comment_count \"NOT NULL, 评论数统计(冗余)\"\n        DATETIME published_at \"发布时间\"\n        DATETIME created_at \"NOT NULL\"\n        DATETIME updated_at \"NOT NULL\"\n        DATETIME deleted_at \"软删除时间\"\n    }\n    post_tag {\n        BIGINT post_id PK \"文章ID\"\n        INT tag_id PK \"标签ID\"\n        DATETIME created_at \"NOT NULL, 关联创建时间\"\n    }\n    category ||--o{ category : \"parent_id\"\n    user ||--o{ post : \"author_id\"\n    category ||--o{ post : \"category_id\"\n    post ||--o{ post_tag : \"post_id\"\n    tag ||--o{ post_tag : \"tag_id\"', 'http://localhost:8080/api/image/diagrams/7/1770792640173_gfgfz_.png', 5, 5, '2026-02-11 14:50:40', '2026-02-11 14:50:40');
INSERT INTO `biz_diagram` VALUES (10, 7, 'personal', NULL, 'dsds', '', 'AI', 'mysql', 'erDiagram\n    users {\n        BIGINT id PK \"用户主键ID\"\n        VARCHAR(50) username \"NOT NULL, 用户名，用于登录\"\n        VARCHAR(100) email \"NOT NULL, 邮箱，用于登录和通知\"\n        VARCHAR(255) password_hash \"NOT NULL, 密码哈希值\"\n        VARCHAR(500) avatar_url \"头像URL\"\n        TINYINT status \"NOT NULL, 状态：0-禁用，1-正常，2-未激活\"\n        DATETIME last_login_at \"最后登录时间\"\n        DATETIME created_at \"NOT NULL, 创建时间\"\n        DATETIME updated_at \"NOT NULL, 更新时间\"\n        DATETIME deleted_at \"软删除时间\"\n    }\n    authors {\n        BIGINT id PK \"作者主键ID\"\n        BIGINT user_id FK \"NOT NULL, 关联用户ID\"\n        VARCHAR(50) pen_name \"笔名/昵称，展示用\"\n        TEXT bio \"作者简介\"\n        VARCHAR(200) website \"个人网站\"\n        JSON social_links \"社交媒体链接，如微博、GitHub等\"\n        TINYINT verified \"NOT NULL, 是否认证作者：0-否，1-是\"\n        INT post_count \"NOT NULL, 发表文章数统计\"\n        INT follower_count \"NOT NULL, 粉丝数统计\"\n        DATETIME created_at \"NOT NULL, 创建时间\"\n        DATETIME updated_at \"NOT NULL, 更新时间\"\n    }\n    categories {\n        INT id PK \"分类主键ID\"\n        INT parent_id FK \"父分类ID，NULL为顶级分类\"\n        VARCHAR(50) name \"NOT NULL, 分类名称\"\n        VARCHAR(50) slug \"NOT NULL, URL友好标识\"\n        VARCHAR(255) description \"分类描述\"\n        INT sort_order \"NOT NULL, 排序权重\"\n        TINYINT is_visible \"NOT NULL, 是否可见：0-隐藏，1-显示\"\n        DATETIME created_at \"NOT NULL, 创建时间\"\n        DATETIME updated_at \"NOT NULL, 更新时间\"\n    }\n    tags {\n        INT id PK \"标签主键ID\"\n        VARCHAR(30) name \"NOT NULL, 标签名称\"\n        VARCHAR(30) slug \"NOT NULL, URL友好标识\"\n        INT usage_count \"NOT NULL, 使用次数统计\"\n        DATETIME created_at \"NOT NULL, 创建时间\"\n    }\n    posts {\n        BIGINT id PK \"文章主键ID\"\n        BIGINT author_id FK \"NOT NULL, 作者ID\"\n        VARCHAR(200) title \"NOT NULL, 文章标题\"\n        VARCHAR(200) slug \"NOT NULL, URL友好标识\"\n        VARCHAR(500) summary \"文章摘要\"\n        LONGTEXT content \"NOT NULL, 文章内容(Markdown/HTML)\"\n        VARCHAR(500) cover_image \"封面图URL\"\n        TINYINT status \"NOT NULL, 状态：0-草稿，1-已发布，2-私密，3-回收站\"\n        TINYINT visibility \"NOT NULL, 可见性：1-公开，2-仅粉丝，3-密码保护\"\n        VARCHAR(64) password \"访问密码（加密存储）\"\n        DATETIME published_at \"发布时间\"\n        INT view_count \"NOT NULL, 浏览次数\"\n        INT like_count \"NOT NULL, 点赞次数\"\n        INT comment_count \"NOT NULL, 评论数统计\"\n        TINYINT allow_comment \"NOT NULL, 是否允许评论：0-否，1-是\"\n        VARCHAR(500) source_url \"原文链接（转载时填写）\"\n        DATETIME created_at \"NOT NULL, 创建时间\"\n        DATETIME updated_at \"NOT NULL, 更新时间\"\n        DATETIME deleted_at \"软删除时间\"\n    }\n    post_categories {\n        BIGINT id PK \"关联主键ID\"\n        BIGINT post_id FK \"NOT NULL, 文章ID\"\n        INT category_id FK \"NOT NULL, 分类ID\"\n        TINYINT is_primary \"NOT NULL, 是否主分类：0-否，1-是（每篇文章只有一个主分类）\"\n        DATETIME created_at \"NOT NULL, 创建时间\"\n    }\n    users ||--o{ authors : \"user_id\"\n    categories ||--o{ categories : \"parent_id\"\n    authors ||--o{ posts : \"author_id\"\n    posts ||--o{ post_categories : \"post_id\"\n    categories ||--o{ post_categories : \"category_id\"', 'http://localhost:8080/api/image/diagrams/7/1770793053551_dsds.png', 6, 5, '2026-02-11 14:57:34', '2026-02-11 14:57:34');
INSERT INTO `biz_diagram` VALUES (11, 7, 'personal', NULL, '测试sql生成', '', 'AI', 'mysql', 'erDiagram\n    user {\n        BIGINT id PK \"用户ID\"\n        VARCHAR(255) email \"NOT NULL, 邮箱，登录账号\"\n        VARCHAR(255) password_hash \"NOT NULL, 密码哈希\"\n        VARCHAR(50) nickname \"NOT NULL, 昵称\"\n        VARCHAR(500) avatar_url \"头像URL\"\n        VARCHAR(20) phone \"手机号\"\n        TINYINT status \"NOT NULL, 状态：0-禁用，1-启用\"\n        DATETIME last_login_at \"最后登录时间\"\n        DATETIME created_at \"NOT NULL, 创建时间\"\n        DATETIME updated_at \"NOT NULL, 更新时间\"\n    }\n    workspace {\n        BIGINT id PK \"工作空间ID\"\n        VARCHAR(100) name \"NOT NULL, 工作空间名称\"\n        TEXT description \"描述\"\n        BIGINT owner_id FK \"NOT NULL, 所有者用户ID\"\n        VARCHAR(500) logo_url \"Logo URL\"\n        TINYINT visibility \"NOT NULL, 可见性：0-私有，1-内部，2-公开\"\n        TINYINT status \"NOT NULL, 状态：0-归档，1-活跃\"\n        DATETIME created_at \"NOT NULL\"\n        DATETIME updated_at \"NOT NULL\"\n    }\n    workspace_member {\n        BIGINT id PK\n        BIGINT workspace_id FK \"NOT NULL, 工作空间ID\"\n        BIGINT user_id FK \"NOT NULL, 用户ID\"\n        TINYINT role \"NOT NULL, 角色：0-所有者，1-管理员，2-成员\"\n        DATETIME joined_at \"NOT NULL, 加入时间\"\n        DATETIME created_at \"NOT NULL\"\n        DATETIME updated_at \"NOT NULL\"\n    }\n    project {\n        BIGINT id PK \"项目ID\"\n        BIGINT workspace_id FK \"NOT NULL, 所属工作空间ID\"\n        VARCHAR(100) name \"NOT NULL, 项目名称\"\n        TEXT description \"项目描述\"\n        VARCHAR(10) key_code \"NOT NULL, 项目标识码，如 PROJ\"\n        VARCHAR(7) color \"主题色\"\n        DATE start_date \"开始日期\"\n        DATE end_date \"截止日期\"\n        TINYINT status \"NOT NULL, 状态：0-进行中，1-已完成，2-已归档\"\n        BIGINT default_board_id \"默认看板ID\"\n        BIGINT created_by FK \"NOT NULL, 创建人ID\"\n        DATETIME created_at \"NOT NULL\"\n        DATETIME updated_at \"NOT NULL\"\n    }\n    project_member {\n        BIGINT id PK\n        BIGINT project_id FK \"NOT NULL, 项目ID\"\n        BIGINT user_id FK \"NOT NULL, 用户ID\"\n        TINYINT role \"NOT NULL, 角色：0-项目负责人，1-管理员，2-开发，3-访客\"\n        DATETIME joined_at \"NOT NULL\"\n        DATETIME created_at \"NOT NULL\"\n        DATETIME updated_at \"NOT NULL\"\n    }\n    board {\n        BIGINT id PK \"看板ID\"\n        BIGINT project_id FK \"NOT NULL, 所属项目ID\"\n        VARCHAR(100) name \"NOT NULL, 看板名称\"\n        TEXT description \"看板描述\"\n        TINYINT layout_type \"NOT NULL, 布局类型：0-看板，1-列表，2-日历，3-甘特图\"\n        INT sort_order \"NOT NULL, 排序序号\"\n        TINYINT is_default \"NOT NULL, 是否为默认看板：0-否，1-是\"\n        JSON filter_config \"筛选配置JSON\"\n        BIGINT created_by FK \"NOT NULL, 创建人ID\"\n        DATETIME created_at \"NOT NULL\"\n        DATETIME updated_at \"NOT NULL\"\n    }\n    user ||--o{ workspace : \"owner_id\"\n    workspace ||--o{ workspace_member : \"workspace_id\"\n    user ||--o{ workspace_member : \"user_id\"\n    workspace ||--o{ project : \"workspace_id\"\n    user ||--o{ project : \"created_by\"\n    project ||--o{ project_member : \"project_id\"\n    user ||--o{ project_member : \"user_id\"\n    project ||--o{ board : \"project_id\"\n    user ||--o{ board : \"created_by\"', 'http://localhost:8080/api/image/diagrams/7/1770793583676_测试sql生成.png', 6, 9, '2026-02-11 15:06:24', '2026-02-11 15:06:24');
INSERT INTO `biz_diagram` VALUES (12, 7, 'personal', NULL, '测试项目结构图', '', 'ARCH', NULL, 'graph TD\n    n0[\"数据库系统\"]\n    n1[\"业务管理子系统\"]\n    n2[\"架构图表\"]\n    n3[\"支付订单表\"]\n    n4[\"计划配额配置表\"]\n    n5[\"项目配置表\"]\n    n6[\"项目版本表\"]\n    n7[\"项目表\"]\n    n8[\"订阅计划表\"]\n    n9[\"团队表\"]\n    n10[\"团队邀请链接表\"]\n    n11[\"邀请使用记录表\"]\n    n12[\"团队操作日志表\"]\n    n13[\"团队成员表\"]\n    n14[\"用户配额使用跟踪表\"]\n    n15[\"用户订阅表\"]\n    n16[\"系统管理子系统\"]\n    n17[\"系统配置表\"]\n    n18[\"用户表\"]\n\n    n0 --> n1\n    n1 --> n2\n    n1 --> n3\n    n1 --> n4\n    n1 --> n5\n    n1 --> n6\n    n1 --> n7\n    n1 --> n8\n    n1 --> n9\n    n1 --> n10\n    n1 --> n11\n    n1 --> n12\n    n1 --> n13\n    n1 --> n14\n    n1 --> n15\n    n0 --> n16\n    n16 --> n17\n    n16 --> n18\n\n    classDef default fill:#fff,stroke:#333,stroke-width:1px,color:#333\n    classDef root fill:#f0f0f0,stroke:#333,stroke-width:2px,color:#333,font-weight:bold\n    classDef sub fill:#fff,stroke:#333,stroke-width:1.5px,color:#333,font-weight:bold\n    classDef leaf fill:#fff,stroke:#666,stroke-width:1px,color:#555\n    class n0 root\n    class n1 sub\n    class n2 leaf\n    class n3 leaf\n    class n4 leaf\n    class n5 leaf\n    class n6 leaf\n    class n7 leaf\n    class n8 leaf\n    class n9 leaf\n    class n10 leaf\n    class n11 leaf\n    class n12 leaf\n    class n13 leaf\n    class n14 leaf\n    class n15 leaf\n    class n16 sub\n    class n17 leaf\n    class n18 leaf\n', NULL, 19, 0, '2026-02-11 16:20:49', '2026-02-11 16:20:49');
INSERT INTO `biz_diagram` VALUES (13, 20, 'personal', NULL, 'ff', '', 'ARCH', NULL, 'graph TD\n    n0[\"数据库系统\"]\n    n1[\"业务管理子系统\"]\n    n2[\"架构图表\"]\n    n3[\"支付订单表\"]\n    n4[\"计划配额配置表\"]\n    n5[\"项目配置表\"]\n    n6[\"项目版本表\"]\n    n7[\"项目表\"]\n    n8[\"订阅计划表\"]\n    n9[\"团队表\"]\n    n10[\"团队邀请链接表\"]\n    n11[\"邀请使用记录表\"]\n    n12[\"团队操作日志表\"]\n    n13[\"团队成员表\"]\n    n14[\"用户配额使用跟踪表\"]\n    n15[\"用户订阅表\"]\n    n16[\"系统管理子系统\"]\n    n17[\"系统配置表\"]\n    n18[\"用户表\"]\n\n    n0 --> n1\n    n1 --> n2\n    n1 --> n3\n    n1 --> n4\n    n1 --> n5\n    n1 --> n6\n    n1 --> n7\n    n1 --> n8\n    n1 --> n9\n    n1 --> n10\n    n1 --> n11\n    n1 --> n12\n    n1 --> n13\n    n1 --> n14\n    n1 --> n15\n    n0 --> n16\n    n16 --> n17\n    n16 --> n18\n\n    classDef default fill:#fff,stroke:#333,stroke-width:1px,color:#333\n    classDef root fill:#f0f0f0,stroke:#333,stroke-width:2px,color:#333,font-weight:bold\n    classDef sub fill:#fff,stroke:#333,stroke-width:1.5px,color:#333,font-weight:bold\n    classDef leaf fill:#fff,stroke:#666,stroke-width:1px,color:#555\n    class n0 root\n    class n1 sub\n    class n2 leaf\n    class n3 leaf\n    class n4 leaf\n    class n5 leaf\n    class n6 leaf\n    class n7 leaf\n    class n8 leaf\n    class n9 leaf\n    class n10 leaf\n    class n11 leaf\n    class n12 leaf\n    class n13 leaf\n    class n14 leaf\n    class n15 leaf\n    class n16 sub\n    class n17 leaf\n    class n18 leaf\n', 'http://localhost:8080/api/image/diagrams/20/1770798394294_ff.png', 19, 0, '2026-02-11 16:26:34', '2026-02-11 16:26:34');

-- ----------------------------
-- Table structure for biz_payment_order
-- ----------------------------
DROP TABLE IF EXISTS `biz_payment_order`;
CREATE TABLE `biz_payment_order`  (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '订单ID',
  `order_no` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL COMMENT '订单号',
  `user_id` bigint NOT NULL COMMENT '用户ID',
  `subscription_id` bigint NULL DEFAULT NULL COMMENT '订阅ID',
  `plan_id` bigint NOT NULL COMMENT '计划ID',
  `plan_code` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL COMMENT '计划代码',
  `billing_cycle` varchar(20) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL DEFAULT 'monthly' COMMENT '计费周期',
  `amount` decimal(10, 2) NOT NULL COMMENT '订单金额',
  `currency` varchar(10) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL DEFAULT 'CNY' COMMENT '货币类型',
  `payment_method` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL DEFAULT NULL COMMENT '支付方式',
  `payment_status` varchar(20) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL DEFAULT 'pending' COMMENT '支付状态（pending/paid/failed/refunded）',
  `transaction_id` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL DEFAULT NULL COMMENT '第三方交易ID',
  `payment_time` datetime NULL DEFAULT NULL COMMENT '支付时间',
  `refund_time` datetime NULL DEFAULT NULL COMMENT '退款时间',
  `refund_reason` text CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL COMMENT '退款原因',
  `remark` text CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL COMMENT '备注',
  `create_time` datetime NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` datetime NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`) USING BTREE,
  UNIQUE INDEX `uk_order_no`(`order_no` ASC) USING BTREE,
  INDEX `idx_user_id`(`user_id` ASC) USING BTREE,
  INDEX `idx_subscription_id`(`subscription_id` ASC) USING BTREE,
  INDEX `idx_payment_status`(`payment_status` ASC) USING BTREE,
  INDEX `idx_create_time`(`create_time` ASC) USING BTREE,
  CONSTRAINT `fk_order_user` FOREIGN KEY (`user_id`) REFERENCES `sys_user` (`id`) ON DELETE CASCADE ON UPDATE RESTRICT
) ENGINE = InnoDB AUTO_INCREMENT = 8 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_unicode_ci COMMENT = '支付订单表' ROW_FORMAT = DYNAMIC;

-- ----------------------------
-- Records of biz_payment_order
-- ----------------------------
INSERT INTO `biz_payment_order` VALUES (1, 'PAY20260208145150509045', 1, NULL, 2, 'PRO', 'monthly', 29.00, 'CNY', 'ALIPAY', 'pending', NULL, NULL, NULL, NULL, NULL, '2026-02-08 14:51:51', '2026-02-08 14:51:51');
INSERT INTO `biz_payment_order` VALUES (2, 'PAY20260208174645871407', 1, NULL, 2, 'PRO', 'monthly', 29.00, 'CNY', 'ALIPAY', 'pending', NULL, NULL, NULL, NULL, NULL, '2026-02-08 17:46:45', '2026-02-08 17:46:45');
INSERT INTO `biz_payment_order` VALUES (3, 'PAY20260208175209919583', 1, NULL, 2, 'PRO', 'monthly', 29.00, 'CNY', 'ALIPAY', 'pending', NULL, NULL, NULL, NULL, NULL, '2026-02-08 17:52:10', '2026-02-08 17:52:10');
INSERT INTO `biz_payment_order` VALUES (4, 'PAY20260208175818157234', 1, NULL, 2, 'PRO', 'monthly', 29.00, 'CNY', 'ALIPAY', 'pending', NULL, NULL, NULL, NULL, NULL, '2026-02-08 17:58:18', '2026-02-08 17:58:18');
INSERT INTO `biz_payment_order` VALUES (5, 'PAY20260211150912990917', 5, NULL, 2, 'PRO', 'monthly', 29.00, 'CNY', 'ALIPAY', 'pending', NULL, NULL, NULL, NULL, NULL, '2026-02-11 15:09:12', '2026-02-11 15:09:12');
INSERT INTO `biz_payment_order` VALUES (6, 'PAY20260211151434569007', 5, 6, 2, 'PRO', 'monthly', 29.00, 'CNY', 'ALIPAY', 'paid', 'SIM_1770794164315', '2026-02-11 15:16:04', NULL, NULL, NULL, '2026-02-11 15:14:34', '2026-02-11 15:14:34');
INSERT INTO `biz_payment_order` VALUES (7, 'PAY20260211152105289632', 6, 8, 2, 'PRO', 'monthly', 29.00, 'CNY', 'ALIPAY', 'paid', 'SIM_1770794466945', '2026-02-11 15:21:07', NULL, NULL, NULL, '2026-02-11 15:21:06', '2026-02-11 15:21:06');

-- ----------------------------
-- Table structure for biz_plan_quota
-- ----------------------------
DROP TABLE IF EXISTS `biz_plan_quota`;
CREATE TABLE `biz_plan_quota`  (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '配额ID',
  `plan_id` bigint NOT NULL COMMENT '订阅计划ID',
  `quota_type` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL COMMENT '配额类型（repository/diagram/sql_parse/ai_generate）',
  `quota_limit` int NOT NULL COMMENT '配额限制（-1表示无限制）',
  `reset_cycle` varchar(20) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL DEFAULT 'monthly' COMMENT '重置周期（daily/monthly/yearly/never）',
  `description` text CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL COMMENT '配额描述',
  `create_time` datetime NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` datetime NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`) USING BTREE,
  UNIQUE INDEX `uk_plan_quota_type`(`plan_id` ASC, `quota_type` ASC) USING BTREE,
  INDEX `idx_plan_id`(`plan_id` ASC) USING BTREE,
  CONSTRAINT `fk_plan_quota_plan` FOREIGN KEY (`plan_id`) REFERENCES `biz_subscription_plan` (`id`) ON DELETE CASCADE ON UPDATE RESTRICT
) ENGINE = InnoDB AUTO_INCREMENT = 37 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_unicode_ci COMMENT = '计划配额配置表' ROW_FORMAT = Dynamic;

-- ----------------------------
-- Records of biz_plan_quota
-- ----------------------------
INSERT INTO `biz_plan_quota` VALUES (1, 1, 'ai_generate', 0, 'never', 'AI生成不可用', '2026-02-10 17:31:37', '2026-02-10 17:35:37');
INSERT INTO `biz_plan_quota` VALUES (2, 1, 'diagram', 10, 'monthly', '每月10次架构图保存', '2026-02-10 17:31:37', '2026-02-10 17:43:01');
INSERT INTO `biz_plan_quota` VALUES (3, 1, 'repository', 3, 'never', '最多3个归档库', '2026-02-10 17:31:37', '2026-02-10 17:35:37');
INSERT INTO `biz_plan_quota` VALUES (4, 1, 'sql_parse', 50, 'monthly', '每月50次SQL解析操作', '2026-02-10 17:31:37', '2026-02-10 17:35:37');
INSERT INTO `biz_plan_quota` VALUES (5, 3, 'ai_generate', 1000, 'monthly', '每月1000次AI生成', '2026-02-10 17:31:37', '2026-02-10 17:43:01');
INSERT INTO `biz_plan_quota` VALUES (6, 3, 'diagram', -1, 'never', '无限架构图保存', '2026-02-10 17:31:37', '2026-02-10 17:43:01');
INSERT INTO `biz_plan_quota` VALUES (7, 3, 'repository', -1, 'never', '无限归档库', '2026-02-10 17:31:37', '2026-02-10 17:43:01');
INSERT INTO `biz_plan_quota` VALUES (8, 3, 'sql_parse', -1, 'never', '无限SQL解析', '2026-02-10 17:31:37', '2026-02-10 17:43:01');
INSERT INTO `biz_plan_quota` VALUES (20, 2, 'repository', 20, 'never', '最多20个归档库', '2026-02-10 17:35:37', '2026-02-10 17:43:01');
INSERT INTO `biz_plan_quota` VALUES (21, 2, 'diagram', 500, 'monthly', '每月500次架构图保存', '2026-02-10 17:35:37', '2026-02-10 17:43:01');
INSERT INTO `biz_plan_quota` VALUES (22, 2, 'sql_parse', 1000, 'monthly', '每月1000次SQL解析', '2026-02-10 17:35:37', '2026-02-10 17:43:01');
INSERT INTO `biz_plan_quota` VALUES (23, 2, 'ai_generate', 100, 'monthly', '每月100次AI生成', '2026-02-10 17:35:37', '2026-02-10 17:43:01');

-- ----------------------------
-- Table structure for biz_project_config
-- ----------------------------
DROP TABLE IF EXISTS `biz_project_config`;
CREATE TABLE `biz_project_config`  (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '配置ID',
  `project_id` bigint NOT NULL COMMENT '项目ID',
  `config_type` varchar(20) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL COMMENT '配置类型（SQL/JDBC）',
  `sql_content` mediumtext CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL COMMENT 'SQL内容',
  `jdbc_url` varchar(500) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL DEFAULT NULL COMMENT 'JDBC URL',
  `jdbc_username` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL DEFAULT NULL COMMENT '数据库用户名',
  `jdbc_password` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL DEFAULT NULL COMMENT '数据库密码（AES加密）',
  `schema_name` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL DEFAULT NULL COMMENT 'Schema名称',
  `render_options` json NULL COMMENT '渲染选项（JSON格式）',
  `create_time` datetime NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  PRIMARY KEY (`id`) USING BTREE,
  UNIQUE INDEX `uk_project_id`(`project_id` ASC) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 8 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_unicode_ci COMMENT = '项目配置表' ROW_FORMAT = DYNAMIC;

-- ----------------------------
-- Records of biz_project_config
-- ----------------------------
INSERT INTO `biz_project_config` VALUES (4, 18, 'SQL', 'erDiagram\n    biz_diagram {\n        BIGINT(19) id PK \"架构图ID\"\n        BIGINT(19) repository_id FK \"NOT NULL, 架构库ID\"\n        VARCHAR(20) save_source \"保存来源: personal-个人, team-团队\"\n        BIGINT(19) save_by_user_id \"保存人ID（团队成员保存时记录）\"\n        VARCHAR(100) diagram_name \"NOT NULL, 架构图名称\"\n        TEXT(65535) description \"架构图描述\"\n        VARCHAR(20) source_type \"NOT NULL, 来源类型（SQL/JDBC/AI）\"\n        VARCHAR(20) db_type \"数据库类型（mysql/postgres）\"\n        TEXT(65535) mermaid_code \"Mermaid源码\"\n        VARCHAR(500) image_url \"图片URL（MinIO存储）\"\n        INT(10) table_count \"表数量\"\n        INT(10) relation_count \"关系数量\"\n        DATETIME(19) create_time \"创建时间\"\n        DATETIME(19) update_time \"更新时间\"\n    }\n    biz_payment_order {\n        BIGINT(19) id PK \"订单ID\"\n        VARCHAR(50) order_no \"NOT NULL, 订单号\"\n        BIGINT(19) user_id FK \"NOT NULL, 用户ID\"\n        BIGINT(19) subscription_id \"订阅ID\"\n        BIGINT(19) plan_id \"NOT NULL, 计划ID\"\n        VARCHAR(50) plan_code \"NOT NULL, 计划代码\"\n        VARCHAR(20) billing_cycle \"计费周期\"\n        DECIMAL(10_2) amount \"NOT NULL, 订单金额\"\n        VARCHAR(10) currency \"货币类型\"\n        VARCHAR(50) payment_method \"支付方式\"\n        VARCHAR(20) payment_status \"支付状态（pending/paid/failed/refunded）\"\n        VARCHAR(100) transaction_id \"第三方交易ID\"\n        DATETIME(19) payment_time \"支付时间\"\n        DATETIME(19) refund_time \"退款时间\"\n        TEXT(65535) refund_reason \"退款原因\"\n        TEXT(65535) remark \"备注\"\n        DATETIME(19) create_time \"创建时间\"\n        DATETIME(19) update_time \"更新时间\"\n    }\n    biz_plan_quota {\n        BIGINT(19) id PK \"配额ID\"\n        BIGINT(19) plan_id FK \"NOT NULL, 订阅计划ID\"\n        VARCHAR(50) quota_type \"NOT NULL, 配额类型（repository/diagram/sql_parse/ai_generate）\"\n        INT(10) quota_limit \"NOT NULL, 配额限制（-1表示无限制）\"\n        VARCHAR(20) reset_cycle \"重置周期（daily/monthly/yearly/never）\"\n        TEXT(65535) description \"配额描述\"\n        DATETIME(19) create_time \"创建时间\"\n        DATETIME(19) update_time \"更新时间\"\n    }\n    biz_project_config {\n        BIGINT(19) id PK \"配置ID\"\n        BIGINT(19) project_id \"NOT NULL, 项目ID\"\n        VARCHAR(20) config_type \"NOT NULL, 配置类型（SQL/JDBC）\"\n        MEDIUMTEXT(16777215) sql_content \"SQL内容\"\n        VARCHAR(500) jdbc_url \"JDBC URL\"\n        VARCHAR(100) jdbc_username \"数据库用户名\"\n        VARCHAR(255) jdbc_password \"数据库密码（AES加密）\"\n        VARCHAR(100) schema_name \"Schema名称\"\n        JSON(1073741824) render_options \"渲染选项（JSON格式）\"\n        DATETIME(19) create_time \"创建时间\"\n    }\n    biz_repository {\n        BIGINT(19) id PK \"项目ID\"\n        BIGINT(19) user_id FK \"NOT NULL, 用户ID\"\n        VARCHAR(100) repository_name \"NOT NULL, 架构库名称\"\n        TEXT(65535) description \"项目描述\"\n        INT(10) diagram_count \"架构图数量\"\n        VARCHAR(20) status \"状态（DRAFT/PUBLISHED）\"\n        BIT(1) is_team_repository \"是否为团队归档库\"\n        DATETIME(19) create_time \"创建时间\"\n        DATETIME(19) update_time \"更新时间\"\n    }\n    biz_subscription_plan {\n        BIGINT(19) id PK \"计划ID\"\n        VARCHAR(50) plan_code \"NOT NULL, 计划代码（FREE/PRO/TEAM）\"\n        VARCHAR(100) plan_name \"NOT NULL, 计划名称\"\n        VARCHAR(100) plan_name_en \"计划英文名称\"\n        TEXT(65535) description \"计划描述\"\n        DECIMAL(10_2) price_monthly \"月付价格\"\n        DECIMAL(10_2) price_yearly \"年付价格\"\n        INT(10) max_repositories \"最大架构库数量（-1表示无限制）\"\n        INT(10) max_diagrams_per_repo \"每个库最大架构图数量（-1表示无限制）\"\n        INT(10) max_sql_size_mb \"最大SQL文件大小（MB）\"\n        TINYINT(3) support_jdbc \"是否支持JDBC连接（0=否，1=是）\"\n        TINYINT(3) support_ai \"是否支持AI功能（0=否，1=是）\"\n        TINYINT(3) support_export \"是否支持导出（0=否，1=是）\"\n        TINYINT(3) support_team \"是否支持团队协作（0=否，1=是）\"\n        INT(10) max_teams \"最大团队数量\"\n        INT(10) max_team_members \"每个团队最大成员数\"\n        TINYINT(3) priority_support \"是否优先支持（0=否，1=是）\"\n        JSON(1073741824) features \"功能特性列表（JSON格式）\"\n        INT(10) sort_order \"排序顺序\"\n        VARCHAR(20) status \"状态（active/inactive）\"\n        DATETIME(19) create_time \"创建时间\"\n        DATETIME(19) update_time \"更新时间\"\n    }\n    biz_team {\n        BIGINT(19) id PK \"团队ID\"\n        VARCHAR(100) team_name \"NOT NULL, 团队名称\"\n        VARCHAR(50) team_code \"NOT NULL, 团队唯一标识\"\n        TEXT(65535) description \"团队描述\"\n        VARCHAR(500) avatar_url \"团队头像\"\n        BIGINT(19) owner_id \"NOT NULL, 所有者ID\"\n        BIGINT(19) repository_id \"NOT NULL, 绑定的架构归档库ID\"\n        INT(10) member_count \"成员数量\"\n        INT(10) max_members \"最大成员数（根据订阅套餐）\"\n        VARCHAR(20) status \"状态: active-活跃, suspended-暂停, deleted-已删除\"\n        DATETIME(19) create_time \"创建时间\"\n        DATETIME(19) update_time \"更新时间\"\n    }\n    biz_team_invitation {\n        BIGINT(19) id PK \"邀请ID\"\n        BIGINT(19) team_id \"NOT NULL, 团队ID\"\n        VARCHAR(50) invite_code \"NOT NULL, 邀请码（UUID）\"\n        VARCHAR(500) invite_url \"NOT NULL, 完整邀请链接\"\n        BIGINT(19) creator_id \"NOT NULL, 创建人ID\"\n        INT(10) max_uses \"最大使用次数（0=无限制）\"\n        INT(10) used_count \"已使用次数\"\n        VARCHAR(20) status \"状态: active-有效, disabled-禁用, expired-已过期\"\n        DATETIME(19) expire_time \"过期时间（NULL=永久有效）\"\n        DATETIME(19) create_time \"创建时间\"\n        DATETIME(19) update_time \"更新时间\"\n    }\n    biz_team_invitation_log {\n        BIGINT(19) id PK \"记录ID\"\n        BIGINT(19) team_id \"NOT NULL, 团队ID\"\n        VARCHAR(50) invite_code \"NOT NULL, 邀请码\"\n        BIGINT(19) user_id \"NOT NULL, 加入用户ID\"\n        VARCHAR(50) username \"用户名\"\n        VARCHAR(100) email \"邮箱\"\n        BIT(1) is_new_user \"是否新注册用户\"\n        DATETIME(19) join_time \"加入时间\"\n        VARCHAR(50) ip_address \"IP地址\"\n        VARCHAR(500) user_agent \"用户代理\"\n    }\n    biz_team_log {\n        BIGINT(19) id PK \"日志ID\"\n        BIGINT(19) team_id \"NOT NULL, 团队ID\"\n        BIGINT(19) user_id \"NOT NULL, 操作人ID\"\n        VARCHAR(50) action \"NOT NULL, 操作类型\"\n        VARCHAR(50) target_type \"目标类型: member-成员, diagram-架构图, team-团队\"\n        BIGINT(19) target_id \"目标ID\"\n        TEXT(65535) description \"操作描述\"\n        VARCHAR(50) ip_address \"IP地址\"\n        VARCHAR(500) user_agent \"用户代理\"\n        DATETIME(19) create_time \"创建时间\"\n    }\n    biz_team_member {\n        BIGINT(19) id PK \"成员ID\"\n        BIGINT(19) team_id \"NOT NULL, 团队ID\"\n        BIGINT(19) user_id \"NOT NULL, 用户ID\"\n        VARCHAR(20) role \"NOT NULL, 角色: owner-所有者, member-成员\"\n        VARCHAR(50) nickname \"团队内昵称\"\n        DATETIME(19) join_time \"加入时间\"\n        VARCHAR(20) join_source \"加入方式: create-创建, invite-邀请\"\n        VARCHAR(50) invite_code \"使用的邀请码\"\n        VARCHAR(20) status \"状态: active-活跃, inactive-停用\"\n        DATETIME(19) create_time \"创建时间\"\n        DATETIME(19) update_time \"更新时间\"\n    }\n    biz_user_quota_tracking {\n        BIGINT(19) id PK \"跟踪ID\"\n        BIGINT(19) user_id FK \"NOT NULL, 用户ID\"\n        BIGINT(19) plan_quota_id FK \"NOT NULL, 计划配额ID\"\n        VARCHAR(50) quota_type \"NOT NULL, 配额类型\"\n        INT(10) quota_limit \"NOT NULL, 当前配额限制\"\n        INT(10) quota_used \"已使用配额\"\n        DATETIME(19) last_reset_time \"上次重置时间\"\n        DATETIME(19) create_time \"创建时间\"\n        DATETIME(19) update_time \"更新时间\"\n    }\n    biz_user_subscription {\n        BIGINT(19) id PK \"订阅ID\"\n        BIGINT(19) user_id FK \"NOT NULL, 用户ID\"\n        BIGINT(19) plan_id FK \"NOT NULL, 计划ID\"\n        VARCHAR(50) plan_code \"NOT NULL, 计划代码\"\n        BIGINT(19) payment_order_id FK \"支付订单ID\"\n        VARCHAR(20) billing_cycle \"计费周期（monthly/yearly）\"\n        DECIMAL(10_2) price \"订阅价格\"\n        DATETIME(19) start_time \"NOT NULL, 开始时间\"\n        DATETIME(19) end_time \"NOT NULL, 结束时间\"\n        TINYINT(3) auto_renew \"是否自动续费（0=否，1=是）\"\n        VARCHAR(20) status \"状态（active/expired/cancelled）\"\n        VARCHAR(50) payment_method \"支付方式（wechat/alipay/stripe）\"\n        VARCHAR(100) transaction_id \"交易ID\"\n        DATETIME(19) cancel_time \"取消时间\"\n        TEXT(65535) cancel_reason \"取消原因\"\n        DATETIME(19) create_time \"创建时间\"\n        DATETIME(19) update_time \"更新时间\"\n    }\n    sys_config {\n        BIGINT(19) id PK \"配置ID\"\n        VARCHAR(100) config_key \"NOT NULL, 配置键（唯一）\"\n        TEXT(65535) config_value \"配置值\"\n        VARCHAR(500) description \"描述\"\n        DATETIME(19) create_time \"创建时间\"\n        DATETIME(19) update_time \"更新时间\"\n    }\n    sys_user {\n        BIGINT(19) id PK \"用户ID\"\n        VARCHAR(50) username \"NOT NULL, 用户名（唯一）\"\n        VARCHAR(255) password \"NOT NULL, 密码（BCrypt加密）\"\n        VARCHAR(100) email \"邮箱\"\n        VARCHAR(20) phone \"手机号\"\n        VARCHAR(50) display_name \"显示名称\"\n        VARCHAR(50) job_title \"职位头衔\"\n        VARCHAR(500) avatar_url \"头像URL\"\n        TINYINT(3) status \"状态（1=正常，0=禁用）\"\n        DATETIME(19) create_time \"创建时间\"\n        DATETIME(19) update_time \"更新时间\"\n    }\n    biz_repository ||--o{ biz_diagram : \"repository_id\"\n    sys_user ||--o{ biz_payment_order : \"user_id\"\n    biz_subscription_plan ||--o{ biz_plan_quota : \"plan_id\"\n    sys_user ||--o{ biz_repository : \"user_id\"\n    sys_user ||--o{ biz_user_quota_tracking : \"user_id\"\n    biz_plan_quota ||--o{ biz_user_quota_tracking : \"plan_quota_id\"\n    biz_payment_order ||--o{ biz_user_subscription : \"payment_order_id\"\n    biz_subscription_plan ||--o{ biz_user_subscription : \"plan_id\"\n    sys_user ||--o{ biz_user_subscription : \"user_id\"\n', NULL, NULL, NULL, NULL, NULL, '2026-02-10 18:48:26');
INSERT INTO `biz_project_config` VALUES (5, 19, 'SQL', 'erDiagram\n    biz_diagram {\n        BIGINT(19) id PK \"架构图ID\"\n        BIGINT(19) repository_id FK \"NOT NULL, 架构库ID\"\n        VARCHAR(20) save_source \"保存来源: personal-个人, team-团队\"\n        BIGINT(19) save_by_user_id \"保存人ID（团队成员保存时记录）\"\n        VARCHAR(100) diagram_name \"NOT NULL, 架构图名称\"\n        TEXT(65535) description \"架构图描述\"\n        VARCHAR(20) source_type \"NOT NULL, 来源类型（SQL/JDBC/AI）\"\n        VARCHAR(20) db_type \"数据库类型（mysql/postgres）\"\n        TEXT(65535) mermaid_code \"Mermaid源码\"\n        VARCHAR(500) image_url \"图片URL（MinIO存储）\"\n        INT(10) table_count \"表数量\"\n        INT(10) relation_count \"关系数量\"\n        DATETIME(19) create_time \"创建时间\"\n        DATETIME(19) update_time \"更新时间\"\n    }\n    biz_payment_order {\n        BIGINT(19) id PK \"订单ID\"\n        VARCHAR(50) order_no \"NOT NULL, 订单号\"\n        BIGINT(19) user_id FK \"NOT NULL, 用户ID\"\n        BIGINT(19) subscription_id \"订阅ID\"\n        BIGINT(19) plan_id \"NOT NULL, 计划ID\"\n        VARCHAR(50) plan_code \"NOT NULL, 计划代码\"\n        VARCHAR(20) billing_cycle \"计费周期\"\n        DECIMAL(10_2) amount \"NOT NULL, 订单金额\"\n        VARCHAR(10) currency \"货币类型\"\n        VARCHAR(50) payment_method \"支付方式\"\n        VARCHAR(20) payment_status \"支付状态（pending/paid/failed/refunded）\"\n        VARCHAR(100) transaction_id \"第三方交易ID\"\n        DATETIME(19) payment_time \"支付时间\"\n        DATETIME(19) refund_time \"退款时间\"\n        TEXT(65535) refund_reason \"退款原因\"\n        TEXT(65535) remark \"备注\"\n        DATETIME(19) create_time \"创建时间\"\n        DATETIME(19) update_time \"更新时间\"\n    }\n    biz_plan_quota {\n        BIGINT(19) id PK \"配额ID\"\n        BIGINT(19) plan_id FK \"NOT NULL, 订阅计划ID\"\n        VARCHAR(50) quota_type \"NOT NULL, 配额类型（repository/diagram/sql_parse/ai_generate）\"\n        INT(10) quota_limit \"NOT NULL, 配额限制（-1表示无限制）\"\n        VARCHAR(20) reset_cycle \"重置周期（daily/monthly/yearly/never）\"\n        TEXT(65535) description \"配额描述\"\n        DATETIME(19) create_time \"创建时间\"\n        DATETIME(19) update_time \"更新时间\"\n    }\n    biz_project_config {\n        BIGINT(19) id PK \"配置ID\"\n        BIGINT(19) project_id \"NOT NULL, 项目ID\"\n        VARCHAR(20) config_type \"NOT NULL, 配置类型（SQL/JDBC）\"\n        MEDIUMTEXT(16777215) sql_content \"SQL内容\"\n        VARCHAR(500) jdbc_url \"JDBC URL\"\n        VARCHAR(100) jdbc_username \"数据库用户名\"\n        VARCHAR(255) jdbc_password \"数据库密码（AES加密）\"\n        VARCHAR(100) schema_name \"Schema名称\"\n        JSON(1073741824) render_options \"渲染选项（JSON格式）\"\n        DATETIME(19) create_time \"创建时间\"\n    }\n    biz_project_version {\n        BIGINT(19) id PK \"版本ID\"\n        BIGINT(19) project_id \"NOT NULL, 项目ID\"\n        INT(10) version_no \"NOT NULL, 版本号\"\n        TEXT(65535) mermaid_code \"Mermaid源码\"\n        TEXT(65535) change_log \"变更日志\"\n        DATETIME(19) create_time \"创建时间\"\n    }\n    biz_repository {\n        BIGINT(19) id PK \"项目ID\"\n        BIGINT(19) user_id FK \"NOT NULL, 用户ID\"\n        VARCHAR(100) repository_name \"NOT NULL, 架构库名称\"\n        TEXT(65535) description \"项目描述\"\n        INT(10) diagram_count \"架构图数量\"\n        VARCHAR(20) status \"状态（DRAFT/PUBLISHED）\"\n        BIT(1) is_team_repository \"是否为团队归档库\"\n        DATETIME(19) create_time \"创建时间\"\n        DATETIME(19) update_time \"更新时间\"\n    }\n    biz_subscription_plan {\n        BIGINT(19) id PK \"计划ID\"\n        VARCHAR(50) plan_code \"NOT NULL, 计划代码（FREE/PRO/TEAM）\"\n        VARCHAR(100) plan_name \"NOT NULL, 计划名称\"\n        VARCHAR(100) plan_name_en \"计划英文名称\"\n        TEXT(65535) description \"计划描述\"\n        DECIMAL(10_2) price_monthly \"月付价格\"\n        DECIMAL(10_2) price_yearly \"年付价格\"\n        INT(10) max_repositories \"最大架构库数量（-1表示无限制）\"\n        INT(10) max_diagrams_per_repo \"每个库最大架构图数量（-1表示无限制）\"\n        INT(10) max_sql_size_mb \"最大SQL文件大小（MB）\"\n        TINYINT(3) support_jdbc \"是否支持JDBC连接（0=否，1=是）\"\n        TINYINT(3) support_ai \"是否支持AI功能（0=否，1=是）\"\n        TINYINT(3) support_export \"是否支持导出（0=否，1=是）\"\n        TINYINT(3) support_team \"是否支持团队协作（0=否，1=是）\"\n        INT(10) max_teams \"最大团队数量\"\n        INT(10) max_team_members \"每个团队最大成员数\"\n        TINYINT(3) priority_support \"是否优先支持（0=否，1=是）\"\n        JSON(1073741824) features \"功能特性列表（JSON格式）\"\n        INT(10) sort_order \"排序顺序\"\n        VARCHAR(20) status \"状态（active/inactive）\"\n        DATETIME(19) create_time \"创建时间\"\n        DATETIME(19) update_time \"更新时间\"\n    }\n    biz_team {\n        BIGINT(19) id PK \"团队ID\"\n        VARCHAR(100) team_name \"NOT NULL, 团队名称\"\n        VARCHAR(50) team_code \"NOT NULL, 团队唯一标识\"\n        TEXT(65535) description \"团队描述\"\n        VARCHAR(500) avatar_url \"团队头像\"\n        BIGINT(19) owner_id \"NOT NULL, 所有者ID\"\n        BIGINT(19) repository_id \"NOT NULL, 绑定的架构归档库ID\"\n        INT(10) member_count \"成员数量\"\n        INT(10) max_members \"最大成员数（根据订阅套餐）\"\n        VARCHAR(20) status \"状态: active-活跃, suspended-暂停, deleted-已删除\"\n        DATETIME(19) create_time \"创建时间\"\n        DATETIME(19) update_time \"更新时间\"\n    }\n    biz_team_invitation {\n        BIGINT(19) id PK \"邀请ID\"\n        BIGINT(19) team_id \"NOT NULL, 团队ID\"\n        VARCHAR(50) invite_code \"NOT NULL, 邀请码（UUID）\"\n        VARCHAR(500) invite_url \"NOT NULL, 完整邀请链接\"\n        BIGINT(19) creator_id \"NOT NULL, 创建人ID\"\n        INT(10) max_uses \"最大使用次数（0=无限制）\"\n        INT(10) used_count \"已使用次数\"\n        VARCHAR(20) status \"状态: active-有效, disabled-禁用, expired-已过期\"\n        DATETIME(19) expire_time \"过期时间（NULL=永久有效）\"\n        DATETIME(19) create_time \"创建时间\"\n        DATETIME(19) update_time \"更新时间\"\n    }\n    biz_team_invitation_log {\n        BIGINT(19) id PK \"记录ID\"\n        BIGINT(19) team_id \"NOT NULL, 团队ID\"\n        VARCHAR(50) invite_code \"NOT NULL, 邀请码\"\n        BIGINT(19) user_id \"NOT NULL, 加入用户ID\"\n        VARCHAR(50) username \"用户名\"\n        VARCHAR(100) email \"邮箱\"\n        BIT(1) is_new_user \"是否新注册用户\"\n        DATETIME(19) join_time \"加入时间\"\n        VARCHAR(50) ip_address \"IP地址\"\n        VARCHAR(500) user_agent \"用户代理\"\n    }\n    biz_team_log {\n        BIGINT(19) id PK \"日志ID\"\n        BIGINT(19) team_id \"NOT NULL, 团队ID\"\n        BIGINT(19) user_id \"NOT NULL, 操作人ID\"\n        VARCHAR(50) action \"NOT NULL, 操作类型\"\n        VARCHAR(50) target_type \"目标类型: member-成员, diagram-架构图, team-团队\"\n        BIGINT(19) target_id \"目标ID\"\n        TEXT(65535) description \"操作描述\"\n        VARCHAR(50) ip_address \"IP地址\"\n        VARCHAR(500) user_agent \"用户代理\"\n        DATETIME(19) create_time \"创建时间\"\n    }\n    biz_team_member {\n        BIGINT(19) id PK \"成员ID\"\n        BIGINT(19) team_id \"NOT NULL, 团队ID\"\n        BIGINT(19) user_id \"NOT NULL, 用户ID\"\n        VARCHAR(20) role \"NOT NULL, 角色: owner-所有者, member-成员\"\n        VARCHAR(50) nickname \"团队内昵称\"\n        DATETIME(19) join_time \"加入时间\"\n        VARCHAR(20) join_source \"加入方式: create-创建, invite-邀请\"\n        VARCHAR(50) invite_code \"使用的邀请码\"\n        VARCHAR(20) status \"状态: active-活跃, inactive-停用\"\n        DATETIME(19) create_time \"创建时间\"\n        DATETIME(19) update_time \"更新时间\"\n    }\n    biz_user_quota_tracking {\n        BIGINT(19) id PK \"跟踪ID\"\n        BIGINT(19) user_id FK \"NOT NULL, 用户ID\"\n        BIGINT(19) plan_quota_id FK \"NOT NULL, 计划配额ID\"\n        VARCHAR(50) quota_type \"NOT NULL, 配额类型\"\n        INT(10) quota_limit \"NOT NULL, 当前配额限制\"\n        INT(10) quota_used \"已使用配额\"\n        DATETIME(19) last_reset_time \"上次重置时间\"\n        DATETIME(19) create_time \"创建时间\"\n        DATETIME(19) update_time \"更新时间\"\n    }\n    biz_user_subscription {\n        BIGINT(19) id PK \"订阅ID\"\n        BIGINT(19) user_id FK \"NOT NULL, 用户ID\"\n        BIGINT(19) plan_id FK \"NOT NULL, 计划ID\"\n        VARCHAR(50) plan_code \"NOT NULL, 计划代码\"\n        BIGINT(19) payment_order_id FK \"支付订单ID\"\n        VARCHAR(20) billing_cycle \"计费周期（monthly/yearly）\"\n        DECIMAL(10_2) price \"订阅价格\"\n        DATETIME(19) start_time \"NOT NULL, 开始时间\"\n        DATETIME(19) end_time \"NOT NULL, 结束时间\"\n        TINYINT(3) auto_renew \"是否自动续费（0=否，1=是）\"\n        VARCHAR(20) status \"状态（active/expired/cancelled）\"\n        VARCHAR(50) payment_method \"支付方式（wechat/alipay/stripe）\"\n        VARCHAR(100) transaction_id \"交易ID\"\n        DATETIME(19) cancel_time \"取消时间\"\n        TEXT(65535) cancel_reason \"取消原因\"\n        DATETIME(19) create_time \"创建时间\"\n        DATETIME(19) update_time \"更新时间\"\n    }\n    sys_config {\n        BIGINT(19) id PK \"配置ID\"\n        VARCHAR(100) config_key \"NOT NULL, 配置键（唯一）\"\n        TEXT(65535) config_value \"配置值\"\n        VARCHAR(500) description \"描述\"\n        DATETIME(19) create_time \"创建时间\"\n        DATETIME(19) update_time \"更新时间\"\n    }\n    sys_user {\n        BIGINT(19) id PK \"用户ID\"\n        VARCHAR(50) username \"NOT NULL, 用户名（唯一）\"\n        VARCHAR(255) password \"NOT NULL, 密码（BCrypt加密）\"\n        VARCHAR(100) email \"邮箱\"\n        VARCHAR(20) phone \"手机号\"\n        VARCHAR(50) display_name \"显示名称\"\n        VARCHAR(50) job_title \"职位头衔\"\n        VARCHAR(500) avatar_url \"头像URL\"\n        TINYINT(3) status \"状态（1=正常，0=禁用）\"\n        DATETIME(19) create_time \"创建时间\"\n        DATETIME(19) update_time \"更新时间\"\n    }\n    biz_repository ||--o{ biz_diagram : \"repository_id\"\n    sys_user ||--o{ biz_payment_order : \"user_id\"\n    biz_subscription_plan ||--o{ biz_plan_quota : \"plan_id\"\n    sys_user ||--o{ biz_repository : \"user_id\"\n    sys_user ||--o{ biz_user_quota_tracking : \"user_id\"\n    biz_plan_quota ||--o{ biz_user_quota_tracking : \"plan_quota_id\"\n    biz_payment_order ||--o{ biz_user_subscription : \"payment_order_id\"\n    biz_subscription_plan ||--o{ biz_user_subscription : \"plan_id\"\n    sys_user ||--o{ biz_user_subscription : \"user_id\"\n', NULL, NULL, NULL, NULL, NULL, '2026-02-10 18:49:11');
INSERT INTO `biz_project_config` VALUES (6, 20, 'SQL', 'CREATE TABLE `user` (\n    `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT \'用户ID\',\n    `username` VARCHAR(50) NOT NULL COMMENT \'用户名\',\n    `email` VARCHAR(100) NOT NULL COMMENT \'邮箱\',\n    `password_hash` VARCHAR(255) NOT NULL COMMENT \'密码哈希\',\n    `nickname` VARCHAR(50) DEFAULT NULL COMMENT \'昵称\',\n    `avatar_url` VARCHAR(500) DEFAULT NULL COMMENT \'头像URL\',\n    `bio` TEXT COMMENT \'个人简介\',\n    `role` TINYINT UNSIGNED NOT NULL DEFAULT 2 COMMENT \'角色：0-管理员, 1-作者, 2-读者\',\n    `status` TINYINT UNSIGNED NOT NULL DEFAULT 1 COMMENT \'状态：0-禁用, 1-正常\',\n    `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT \'创建时间\',\n    `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT \'更新时间\',\n    `last_login_at` DATETIME DEFAULT NULL COMMENT \'最后登录时间\',\n    PRIMARY KEY (`id`),\n    UNIQUE KEY `uk_user_username` (`username`),\n    UNIQUE KEY `uk_user_email` (`email`),\n    KEY `idx_user_role_status` (`role`, `status`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT=\'用户表\';\n\nCREATE TABLE `category` (\n    `id` INT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT \'分类ID\',\n    `parent_id` INT UNSIGNED DEFAULT NULL COMMENT \'父分类ID，NULL为顶级分类\',\n    `name` VARCHAR(50) NOT NULL COMMENT \'分类名称\',\n    `slug` VARCHAR(50) NOT NULL COMMENT \'URL友好标识\',\n    `description` VARCHAR(255) DEFAULT NULL COMMENT \'分类描述\',\n    `sort_order` INT UNSIGNED NOT NULL DEFAULT 0 COMMENT \'排序权重\',\n    `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    PRIMARY KEY (`id`),\n    UNIQUE KEY `uk_category_slug` (`slug`),\n    KEY `idx_category_parent_id` (`parent_id`),\n    CONSTRAINT `fk_category_parent` FOREIGN KEY (`parent_id`) REFERENCES `category` (`id`) ON DELETE SET NULL\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT=\'文章分类表\';\n\nCREATE TABLE `tag` (\n    `id` INT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT \'标签ID\',\n    `name` VARCHAR(30) NOT NULL COMMENT \'标签名称\',\n    `slug` VARCHAR(30) NOT NULL COMMENT \'URL友好标识\',\n    `usage_count` INT UNSIGNED NOT NULL DEFAULT 0 COMMENT \'使用次数统计\',\n    `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    PRIMARY KEY (`id`),\n    UNIQUE KEY `uk_tag_name` (`name`),\n    UNIQUE KEY `uk_tag_slug` (`slug`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT=\'文章标签表\';\n\nCREATE TABLE `post` (\n    `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT \'文章ID\',\n    `author_id` BIGINT UNSIGNED NOT NULL COMMENT \'作者用户ID\',\n    `category_id` INT UNSIGNED DEFAULT NULL COMMENT \'所属分类ID\',\n    `title` VARCHAR(200) NOT NULL COMMENT \'文章标题\',\n    `slug` VARCHAR(200) NOT NULL COMMENT \'URL友好标识\',\n    `summary` VARCHAR(500) DEFAULT NULL COMMENT \'摘要\',\n    `content` LONGTEXT NOT NULL COMMENT \'正文内容（Markdown/HTML）\',\n    `cover_image` VARCHAR(500) DEFAULT NULL COMMENT \'封面图URL\',\n    `view_count` INT UNSIGNED NOT NULL DEFAULT 0 COMMENT \'浏览次数\',\n    `like_count` INT UNSIGNED NOT NULL DEFAULT 0 COMMENT \'点赞次数\',\n    `comment_count` INT UNSIGNED NOT NULL DEFAULT 0 COMMENT \'评论数统计（冗余字段）\',\n    `status` TINYINT UNSIGNED NOT NULL DEFAULT 0 COMMENT \'状态：0-草稿, 1-已发布, 2-私密, 3-回收站\',\n    `is_top` TINYINT(1) NOT NULL DEFAULT 0 COMMENT \'是否置顶\',\n    `published_at` DATETIME DEFAULT NULL COMMENT \'发布时间\',\n    `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n    `deleted_at` DATETIME DEFAULT NULL COMMENT \'软删除时间\',\n    PRIMARY KEY (`id`),\n    UNIQUE KEY `uk_post_slug` (`slug`),\n    KEY `idx_post_author_status` (`author_id`, `status`),\n    KEY `idx_post_category_status` (`category_id`, `status`),\n    KEY `idx_post_status_published` (`status`, `published_at`),\n    KEY `idx_post_is_top_published` (`is_top`, `published_at`),\n    FULLTEXT KEY `ft_post_title_content` (`title`, `content`),\n    CONSTRAINT `fk_post_author` FOREIGN KEY (`author_id`) REFERENCES `user` (`id`) ON DELETE RESTRICT,\n    CONSTRAINT `fk_post_category` FOREIGN KEY (`category_id`) REFERENCES `category` (`id`) ON DELETE SET NULL\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT=\'文章表\';\n\nCREATE TABLE `post_tag` (\n    `post_id` BIGINT UNSIGNED NOT NULL COMMENT \'文章ID\',\n    `tag_id` INT UNSIGNED NOT NULL COMMENT \'标签ID\',\n    `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    PRIMARY KEY (`post_id`, `tag_id`),\n    KEY `idx_post_tag_tag_id` (`tag_id`),\n    CONSTRAINT `fk_pt_post` FOREIGN KEY (`post_id`) REFERENCES `post` (`id`) ON DELETE CASCADE,\n    CONSTRAINT `fk_pt_tag` FOREIGN KEY (`tag_id`) REFERENCES `tag` (`id`) ON DELETE CASCADE\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT=\'文章标签关联表\';\n\nCREATE TABLE `comment` (\n    `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT \'评论ID\',\n    `post_id` BIGINT UNSIGNED NOT NULL COMMENT \'所属文章ID\',\n    `parent_comment_id` BIGINT UNSIGNED DEFAULT NULL COMMENT \'父评论ID，NULL为一级评论\',\n    `user_id` BIGINT UNSIGNED DEFAULT NULL COMMENT \'注册用户ID，NULL为匿名评论\',\n    `visitor_name` VARCHAR(50) DEFAULT NULL COMMENT \'访客昵称（未登录时）\',\n    `visitor_email` VARCHAR(100) DEFAULT NULL COMMENT \'访客邮箱（未登录时）\',\n    `visitor_website` VARCHAR(200) DEFAULT NULL COMMENT \'访客网站（未登录时）\',\n    `content` TEXT NOT NULL COMMENT \'评论内容\',\n    `like_count` INT UNSIGNED NOT NULL DEFAULT 0 COMMENT \'点赞数\',\n    `status` TINYINT UNSIGNED NOT NULL DEFAULT 0 COMMENT \'状态：0-待审核, 1-已通过, 2-已拒绝, 3-已删除\',\n    `ip_address` VARCHAR(45) DEFAULT NULL COMMENT \'评论者IP\',\n    `user_agent` VARCHAR(500) DEFAULT NULL COMMENT \'浏览器UA\',\n    `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n    PRIMARY KEY (`id`),\n    KEY `idx_comment_post_status` (`post_id`, `status`, `created_at`),\n    KEY `idx_comment_parent_id` (`parent_comment_id`),\n    KEY `idx_comment_user_id` (`user_id`),\n    CONSTRAINT `fk_comment_post` FOREIGN KEY (`post_id`) REFERENCES `post` (`id`) ON DELETE CASCADE,\n    CONSTRAINT `fk_comment_parent` FOREIGN KEY (`parent_comment_id`) REFERENCES `comment` (`id`) ON DELETE CASCADE,\n    CONSTRAINT `fk_comment_user` FOREIGN KEY (`user_id`) REFERENCES `user` (`id`) ON DELETE SET NULL\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT=\'评论表\';', NULL, NULL, NULL, NULL, NULL, '2026-02-10 19:20:29');
INSERT INTO `biz_project_config` VALUES (7, 7, 'SQL', 'CREATE TABLE `user` (\n    `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT \'用户ID\',\n    `email` VARCHAR(255) NOT NULL COMMENT \'邮箱，登录账号\',\n    `password_hash` VARCHAR(255) NOT NULL COMMENT \'密码哈希\',\n    `nickname` VARCHAR(50) NOT NULL COMMENT \'昵称\',\n    `avatar_url` VARCHAR(500) DEFAULT NULL COMMENT \'头像URL\',\n    `phone` VARCHAR(20) DEFAULT NULL COMMENT \'手机号\',\n    `status` TINYINT NOT NULL DEFAULT 1 COMMENT \'状态：0-禁用，1-启用\',\n    `last_login_at` DATETIME DEFAULT NULL COMMENT \'最后登录时间\',\n    `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT \'创建时间\',\n    `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT \'更新时间\',\n    PRIMARY KEY (`id`),\n    UNIQUE KEY `uk_user_email` (`email`),\n    KEY `idx_user_status` (`status`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT=\'用户表\';\n\nCREATE TABLE `workspace` (\n    `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT \'工作空间ID\',\n    `name` VARCHAR(100) NOT NULL COMMENT \'工作空间名称\',\n    `description` TEXT DEFAULT NULL COMMENT \'描述\',\n    `owner_id` BIGINT UNSIGNED NOT NULL COMMENT \'所有者用户ID\',\n    `logo_url` VARCHAR(500) DEFAULT NULL COMMENT \'Logo URL\',\n    `visibility` TINYINT NOT NULL DEFAULT 1 COMMENT \'可见性：0-私有，1-内部，2-公开\',\n    `status` TINYINT NOT NULL DEFAULT 1 COMMENT \'状态：0-归档，1-活跃\',\n    `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n    PRIMARY KEY (`id`),\n    KEY `idx_workspace_owner` (`owner_id`),\n    KEY `idx_workspace_status` (`status`),\n    CONSTRAINT `fk_workspace_owner` FOREIGN KEY (`owner_id`) REFERENCES `user` (`id`) ON DELETE RESTRICT\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT=\'工作空间表\';\n\nCREATE TABLE `workspace_member` (\n    `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,\n    `workspace_id` BIGINT UNSIGNED NOT NULL COMMENT \'工作空间ID\',\n    `user_id` BIGINT UNSIGNED NOT NULL COMMENT \'用户ID\',\n    `role` TINYINT NOT NULL DEFAULT 2 COMMENT \'角色：0-所有者，1-管理员，2-成员\',\n    `joined_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT \'加入时间\',\n    `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n    PRIMARY KEY (`id`),\n    UNIQUE KEY `uk_workspace_member` (`workspace_id`, `user_id`),\n    KEY `idx_wsm_user` (`user_id`),\n    KEY `idx_wsm_role` (`role`),\n    CONSTRAINT `fk_wsm_workspace` FOREIGN KEY (`workspace_id`) REFERENCES `workspace` (`id`) ON DELETE CASCADE,\n    CONSTRAINT `fk_wsm_user` FOREIGN KEY (`user_id`) REFERENCES `user` (`id`) ON DELETE CASCADE\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT=\'工作空间成员表\';\n\nCREATE TABLE `project` (\n    `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT \'项目ID\',\n    `workspace_id` BIGINT UNSIGNED NOT NULL COMMENT \'所属工作空间ID\',\n    `name` VARCHAR(100) NOT NULL COMMENT \'项目名称\',\n    `description` TEXT DEFAULT NULL COMMENT \'项目描述\',\n    `key_code` VARCHAR(10) NOT NULL COMMENT \'项目标识码，如 PROJ\',\n    `color` VARCHAR(7) DEFAULT \'#1890ff\' COMMENT \'主题色\',\n    `start_date` DATE DEFAULT NULL COMMENT \'开始日期\',\n    `end_date` DATE DEFAULT NULL COMMENT \'截止日期\',\n    `status` TINYINT NOT NULL DEFAULT 0 COMMENT \'状态：0-进行中，1-已完成，2-已归档\',\n    `default_board_id` BIGINT UNSIGNED DEFAULT NULL COMMENT \'默认看板ID\',\n    `created_by` BIGINT UNSIGNED NOT NULL COMMENT \'创建人ID\',\n    `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n    PRIMARY KEY (`id`),\n    KEY `idx_project_workspace` (`workspace_id`),\n    KEY `idx_project_status` (`status`),\n    KEY `idx_project_created_by` (`created_by`),\n    CONSTRAINT `fk_project_workspace` FOREIGN KEY (`workspace_id`) REFERENCES `workspace` (`id`) ON DELETE CASCADE,\n    CONSTRAINT `fk_project_creator` FOREIGN KEY (`created_by`) REFERENCES `user` (`id`) ON DELETE RESTRICT\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT=\'项目表\';\n\nCREATE TABLE `project_member` (\n    `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,\n    `project_id` BIGINT UNSIGNED NOT NULL COMMENT \'项目ID\',\n    `user_id` BIGINT UNSIGNED NOT NULL COMMENT \'用户ID\',\n    `role` TINYINT NOT NULL DEFAULT 3 COMMENT \'角色：0-项目负责人，1-管理员，2-开发，3-访客\',\n    `joined_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n    PRIMARY KEY (`id`),\n    UNIQUE KEY `uk_project_member` (`project_id`, `user_id`),\n    KEY `idx_pm_user` (`user_id`),\n    KEY `idx_pm_role` (`role`),\n    CONSTRAINT `fk_pm_project` FOREIGN KEY (`project_id`) REFERENCES `project` (`id`) ON DELETE CASCADE,\n    CONSTRAINT `fk_pm_user` FOREIGN KEY (`user_id`) REFERENCES `user` (`id`) ON DELETE CASCADE\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT=\'项目成员表\';\n\nCREATE TABLE `board` (\n    `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT \'看板ID\',\n    `project_id` BIGINT UNSIGNED NOT NULL COMMENT \'所属项目ID\',\n    `name` VARCHAR(100) NOT NULL COMMENT \'看板名称\',\n    `description` TEXT DEFAULT NULL COMMENT \'看板描述\',\n    `layout_type` TINYINT NOT NULL DEFAULT 0 COMMENT \'布局类型：0-看板，1-列表，2-日历，3-甘特图\',\n    `sort_order` INT NOT NULL DEFAULT 0 COMMENT \'排序序号\',\n    `is_default` TINYINT NOT NULL DEFAULT 0 COMMENT \'是否为默认看板：0-否，1-是\',\n    `filter_config` JSON DEFAULT NULL COMMENT \'筛选配置JSON\',\n    `created_by` BIGINT UNSIGNED NOT NULL COMMENT \'创建人ID\',\n    `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n    PRIMARY KEY (`id`),\n    KEY `idx_board_project` (`project_id`),\n    KEY `idx_board_layout` (`layout_type`),\n    KEY `idx_board_sort` (`sort_order`),\n    KEY `idx_board_creator` (`created_by`),\n    CONSTRAINT `fk_board_project` FOREIGN KEY (`project_id`) REFERENCES `project` (`id`) ON DELETE CASCADE,\n    CONSTRAINT `fk_board_creator` FOREIGN KEY (`created_by`) REFERENCES `user` (`id`) ON DELETE RESTRICT\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT=\'看板表\';', NULL, NULL, NULL, NULL, NULL, '2026-02-11 14:50:40');

-- ----------------------------
-- Table structure for biz_project_version
-- ----------------------------
DROP TABLE IF EXISTS `biz_project_version`;
CREATE TABLE `biz_project_version`  (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '版本ID',
  `project_id` bigint NOT NULL COMMENT '项目ID',
  `version_no` int NOT NULL COMMENT '版本号',
  `mermaid_code` text CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL COMMENT 'Mermaid源码',
  `change_log` text CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL COMMENT '变更日志',
  `create_time` datetime NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  PRIMARY KEY (`id`) USING BTREE,
  INDEX `idx_project_id`(`project_id` ASC) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 4 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_unicode_ci COMMENT = '项目版本表' ROW_FORMAT = Dynamic;

-- ----------------------------
-- Records of biz_project_version
-- ----------------------------
INSERT INTO `biz_project_version` VALUES (1, 18, 1, 'erDiagram\n    biz_diagram {\n        BIGINT(19) id PK \"架构图ID\"\n        BIGINT(19) repository_id FK \"NOT NULL, 架构库ID\"\n        VARCHAR(20) save_source \"保存来源: personal-个人, team-团队\"\n        BIGINT(19) save_by_user_id \"保存人ID（团队成员保存时记录）\"\n        VARCHAR(100) diagram_name \"NOT NULL, 架构图名称\"\n        TEXT(65535) description \"架构图描述\"\n        VARCHAR(20) source_type \"NOT NULL, 来源类型（SQL/JDBC/AI）\"\n        VARCHAR(20) db_type \"数据库类型（mysql/postgres）\"\n        TEXT(65535) mermaid_code \"Mermaid源码\"\n        VARCHAR(500) image_url \"图片URL（MinIO存储）\"\n        INT(10) table_count \"表数量\"\n        INT(10) relation_count \"关系数量\"\n        DATETIME(19) create_time \"创建时间\"\n        DATETIME(19) update_time \"更新时间\"\n    }\n    biz_payment_order {\n        BIGINT(19) id PK \"订单ID\"\n        VARCHAR(50) order_no \"NOT NULL, 订单号\"\n        BIGINT(19) user_id FK \"NOT NULL, 用户ID\"\n        BIGINT(19) subscription_id \"订阅ID\"\n        BIGINT(19) plan_id \"NOT NULL, 计划ID\"\n        VARCHAR(50) plan_code \"NOT NULL, 计划代码\"\n        VARCHAR(20) billing_cycle \"计费周期\"\n        DECIMAL(10_2) amount \"NOT NULL, 订单金额\"\n        VARCHAR(10) currency \"货币类型\"\n        VARCHAR(50) payment_method \"支付方式\"\n        VARCHAR(20) payment_status \"支付状态（pending/paid/failed/refunded）\"\n        VARCHAR(100) transaction_id \"第三方交易ID\"\n        DATETIME(19) payment_time \"支付时间\"\n        DATETIME(19) refund_time \"退款时间\"\n        TEXT(65535) refund_reason \"退款原因\"\n        TEXT(65535) remark \"备注\"\n        DATETIME(19) create_time \"创建时间\"\n        DATETIME(19) update_time \"更新时间\"\n    }\n    biz_plan_quota {\n        BIGINT(19) id PK \"配额ID\"\n        BIGINT(19) plan_id FK \"NOT NULL, 订阅计划ID\"\n        VARCHAR(50) quota_type \"NOT NULL, 配额类型（repository/diagram/sql_parse/ai_generate）\"\n        INT(10) quota_limit \"NOT NULL, 配额限制（-1表示无限制）\"\n        VARCHAR(20) reset_cycle \"重置周期（daily/monthly/yearly/never）\"\n        TEXT(65535) description \"配额描述\"\n        DATETIME(19) create_time \"创建时间\"\n        DATETIME(19) update_time \"更新时间\"\n    }\n    biz_project_config {\n        BIGINT(19) id PK \"配置ID\"\n        BIGINT(19) project_id \"NOT NULL, 项目ID\"\n        VARCHAR(20) config_type \"NOT NULL, 配置类型（SQL/JDBC）\"\n        MEDIUMTEXT(16777215) sql_content \"SQL内容\"\n        VARCHAR(500) jdbc_url \"JDBC URL\"\n        VARCHAR(100) jdbc_username \"数据库用户名\"\n        VARCHAR(255) jdbc_password \"数据库密码（AES加密）\"\n        VARCHAR(100) schema_name \"Schema名称\"\n        JSON(1073741824) render_options \"渲染选项（JSON格式）\"\n        DATETIME(19) create_time \"创建时间\"\n    }\n    biz_repository {\n        BIGINT(19) id PK \"项目ID\"\n        BIGINT(19) user_id FK \"NOT NULL, 用户ID\"\n        VARCHAR(100) repository_name \"NOT NULL, 架构库名称\"\n        TEXT(65535) description \"项目描述\"\n        INT(10) diagram_count \"架构图数量\"\n        VARCHAR(20) status \"状态（DRAFT/PUBLISHED）\"\n        BIT(1) is_team_repository \"是否为团队归档库\"\n        DATETIME(19) create_time \"创建时间\"\n        DATETIME(19) update_time \"更新时间\"\n    }\n    biz_subscription_plan {\n        BIGINT(19) id PK \"计划ID\"\n        VARCHAR(50) plan_code \"NOT NULL, 计划代码（FREE/PRO/TEAM）\"\n        VARCHAR(100) plan_name \"NOT NULL, 计划名称\"\n        VARCHAR(100) plan_name_en \"计划英文名称\"\n        TEXT(65535) description \"计划描述\"\n        DECIMAL(10_2) price_monthly \"月付价格\"\n        DECIMAL(10_2) price_yearly \"年付价格\"\n        INT(10) max_repositories \"最大架构库数量（-1表示无限制）\"\n        INT(10) max_diagrams_per_repo \"每个库最大架构图数量（-1表示无限制）\"\n        INT(10) max_sql_size_mb \"最大SQL文件大小（MB）\"\n        TINYINT(3) support_jdbc \"是否支持JDBC连接（0=否，1=是）\"\n        TINYINT(3) support_ai \"是否支持AI功能（0=否，1=是）\"\n        TINYINT(3) support_export \"是否支持导出（0=否，1=是）\"\n        TINYINT(3) support_team \"是否支持团队协作（0=否，1=是）\"\n        INT(10) max_teams \"最大团队数量\"\n        INT(10) max_team_members \"每个团队最大成员数\"\n        TINYINT(3) priority_support \"是否优先支持（0=否，1=是）\"\n        JSON(1073741824) features \"功能特性列表（JSON格式）\"\n        INT(10) sort_order \"排序顺序\"\n        VARCHAR(20) status \"状态（active/inactive）\"\n        DATETIME(19) create_time \"创建时间\"\n        DATETIME(19) update_time \"更新时间\"\n    }\n    biz_team {\n        BIGINT(19) id PK \"团队ID\"\n        VARCHAR(100) team_name \"NOT NULL, 团队名称\"\n        VARCHAR(50) team_code \"NOT NULL, 团队唯一标识\"\n        TEXT(65535) description \"团队描述\"\n        VARCHAR(500) avatar_url \"团队头像\"\n        BIGINT(19) owner_id \"NOT NULL, 所有者ID\"\n        BIGINT(19) repository_id \"NOT NULL, 绑定的架构归档库ID\"\n        INT(10) member_count \"成员数量\"\n        INT(10) max_members \"最大成员数（根据订阅套餐）\"\n        VARCHAR(20) status \"状态: active-活跃, suspended-暂停, deleted-已删除\"\n        DATETIME(19) create_time \"创建时间\"\n        DATETIME(19) update_time \"更新时间\"\n    }\n    biz_team_invitation {\n        BIGINT(19) id PK \"邀请ID\"\n        BIGINT(19) team_id \"NOT NULL, 团队ID\"\n        VARCHAR(50) invite_code \"NOT NULL, 邀请码（UUID）\"\n        VARCHAR(500) invite_url \"NOT NULL, 完整邀请链接\"\n        BIGINT(19) creator_id \"NOT NULL, 创建人ID\"\n        INT(10) max_uses \"最大使用次数（0=无限制）\"\n        INT(10) used_count \"已使用次数\"\n        VARCHAR(20) status \"状态: active-有效, disabled-禁用, expired-已过期\"\n        DATETIME(19) expire_time \"过期时间（NULL=永久有效）\"\n        DATETIME(19) create_time \"创建时间\"\n        DATETIME(19) update_time \"更新时间\"\n    }\n    biz_team_invitation_log {\n        BIGINT(19) id PK \"记录ID\"\n        BIGINT(19) team_id \"NOT NULL, 团队ID\"\n        VARCHAR(50) invite_code \"NOT NULL, 邀请码\"\n        BIGINT(19) user_id \"NOT NULL, 加入用户ID\"\n        VARCHAR(50) username \"用户名\"\n        VARCHAR(100) email \"邮箱\"\n        BIT(1) is_new_user \"是否新注册用户\"\n        DATETIME(19) join_time \"加入时间\"\n        VARCHAR(50) ip_address \"IP地址\"\n        VARCHAR(500) user_agent \"用户代理\"\n    }\n    biz_team_log {\n        BIGINT(19) id PK \"日志ID\"\n        BIGINT(19) team_id \"NOT NULL, 团队ID\"\n        BIGINT(19) user_id \"NOT NULL, 操作人ID\"\n        VARCHAR(50) action \"NOT NULL, 操作类型\"\n        VARCHAR(50) target_type \"目标类型: member-成员, diagram-架构图, team-团队\"\n        BIGINT(19) target_id \"目标ID\"\n        TEXT(65535) description \"操作描述\"\n        VARCHAR(50) ip_address \"IP地址\"\n        VARCHAR(500) user_agent \"用户代理\"\n        DATETIME(19) create_time \"创建时间\"\n    }\n    biz_team_member {\n        BIGINT(19) id PK \"成员ID\"\n        BIGINT(19) team_id \"NOT NULL, 团队ID\"\n        BIGINT(19) user_id \"NOT NULL, 用户ID\"\n        VARCHAR(20) role \"NOT NULL, 角色: owner-所有者, member-成员\"\n        VARCHAR(50) nickname \"团队内昵称\"\n        DATETIME(19) join_time \"加入时间\"\n        VARCHAR(20) join_source \"加入方式: create-创建, invite-邀请\"\n        VARCHAR(50) invite_code \"使用的邀请码\"\n        VARCHAR(20) status \"状态: active-活跃, inactive-停用\"\n        DATETIME(19) create_time \"创建时间\"\n        DATETIME(19) update_time \"更新时间\"\n    }\n    biz_user_quota_tracking {\n        BIGINT(19) id PK \"跟踪ID\"\n        BIGINT(19) user_id FK \"NOT NULL, 用户ID\"\n        BIGINT(19) plan_quota_id FK \"NOT NULL, 计划配额ID\"\n        VARCHAR(50) quota_type \"NOT NULL, 配额类型\"\n        INT(10) quota_limit \"NOT NULL, 当前配额限制\"\n        INT(10) quota_used \"已使用配额\"\n        DATETIME(19) last_reset_time \"上次重置时间\"\n        DATETIME(19) create_time \"创建时间\"\n        DATETIME(19) update_time \"更新时间\"\n    }\n    biz_user_subscription {\n        BIGINT(19) id PK \"订阅ID\"\n        BIGINT(19) user_id FK \"NOT NULL, 用户ID\"\n        BIGINT(19) plan_id FK \"NOT NULL, 计划ID\"\n        VARCHAR(50) plan_code \"NOT NULL, 计划代码\"\n        BIGINT(19) payment_order_id FK \"支付订单ID\"\n        VARCHAR(20) billing_cycle \"计费周期（monthly/yearly）\"\n        DECIMAL(10_2) price \"订阅价格\"\n        DATETIME(19) start_time \"NOT NULL, 开始时间\"\n        DATETIME(19) end_time \"NOT NULL, 结束时间\"\n        TINYINT(3) auto_renew \"是否自动续费（0=否，1=是）\"\n        VARCHAR(20) status \"状态（active/expired/cancelled）\"\n        VARCHAR(50) payment_method \"支付方式（wechat/alipay/stripe）\"\n        VARCHAR(100) transaction_id \"交易ID\"\n        DATETIME(19) cancel_time \"取消时间\"\n        TEXT(65535) cancel_reason \"取消原因\"\n        DATETIME(19) create_time \"创建时间\"\n        DATETIME(19) update_time \"更新时间\"\n    }\n    sys_config {\n        BIGINT(19) id PK \"配置ID\"\n        VARCHAR(100) config_key \"NOT NULL, 配置键（唯一）\"\n        TEXT(65535) config_value \"配置值\"\n        VARCHAR(500) description \"描述\"\n        DATETIME(19) create_time \"创建时间\"\n        DATETIME(19) update_time \"更新时间\"\n    }\n    sys_user {\n        BIGINT(19) id PK \"用户ID\"\n        VARCHAR(50) username \"NOT NULL, 用户名（唯一）\"\n        VARCHAR(255) password \"NOT NULL, 密码（BCrypt加密）\"\n        VARCHAR(100) email \"邮箱\"\n        VARCHAR(20) phone \"手机号\"\n        VARCHAR(50) display_name \"显示名称\"\n        VARCHAR(50) job_title \"职位头衔\"\n        VARCHAR(500) avatar_url \"头像URL\"\n        TINYINT(3) status \"状态（1=正常，0=禁用）\"\n        DATETIME(19) create_time \"创建时间\"\n        DATETIME(19) update_time \"更新时间\"\n    }\n    biz_repository ||--o{ biz_diagram : \"repository_id\"\n    sys_user ||--o{ biz_payment_order : \"user_id\"\n    biz_subscription_plan ||--o{ biz_plan_quota : \"plan_id\"\n    sys_user ||--o{ biz_repository : \"user_id\"\n    sys_user ||--o{ biz_user_quota_tracking : \"user_id\"\n    biz_plan_quota ||--o{ biz_user_quota_tracking : \"plan_quota_id\"\n    biz_payment_order ||--o{ biz_user_subscription : \"payment_order_id\"\n    biz_subscription_plan ||--o{ biz_user_subscription : \"plan_id\"\n    sys_user ||--o{ biz_user_subscription : \"user_id\"\n', '初始版本', '2026-02-10 18:48:26');
INSERT INTO `biz_project_version` VALUES (2, 19, 1, 'erDiagram\n    biz_diagram {\n        BIGINT(19) id PK \"架构图ID\"\n        BIGINT(19) repository_id FK \"NOT NULL, 架构库ID\"\n        VARCHAR(20) save_source \"保存来源: personal-个人, team-团队\"\n        BIGINT(19) save_by_user_id \"保存人ID（团队成员保存时记录）\"\n        VARCHAR(100) diagram_name \"NOT NULL, 架构图名称\"\n        TEXT(65535) description \"架构图描述\"\n        VARCHAR(20) source_type \"NOT NULL, 来源类型（SQL/JDBC/AI）\"\n        VARCHAR(20) db_type \"数据库类型（mysql/postgres）\"\n        TEXT(65535) mermaid_code \"Mermaid源码\"\n        VARCHAR(500) image_url \"图片URL（MinIO存储）\"\n        INT(10) table_count \"表数量\"\n        INT(10) relation_count \"关系数量\"\n        DATETIME(19) create_time \"创建时间\"\n        DATETIME(19) update_time \"更新时间\"\n    }\n    biz_payment_order {\n        BIGINT(19) id PK \"订单ID\"\n        VARCHAR(50) order_no \"NOT NULL, 订单号\"\n        BIGINT(19) user_id FK \"NOT NULL, 用户ID\"\n        BIGINT(19) subscription_id \"订阅ID\"\n        BIGINT(19) plan_id \"NOT NULL, 计划ID\"\n        VARCHAR(50) plan_code \"NOT NULL, 计划代码\"\n        VARCHAR(20) billing_cycle \"计费周期\"\n        DECIMAL(10_2) amount \"NOT NULL, 订单金额\"\n        VARCHAR(10) currency \"货币类型\"\n        VARCHAR(50) payment_method \"支付方式\"\n        VARCHAR(20) payment_status \"支付状态（pending/paid/failed/refunded）\"\n        VARCHAR(100) transaction_id \"第三方交易ID\"\n        DATETIME(19) payment_time \"支付时间\"\n        DATETIME(19) refund_time \"退款时间\"\n        TEXT(65535) refund_reason \"退款原因\"\n        TEXT(65535) remark \"备注\"\n        DATETIME(19) create_time \"创建时间\"\n        DATETIME(19) update_time \"更新时间\"\n    }\n    biz_plan_quota {\n        BIGINT(19) id PK \"配额ID\"\n        BIGINT(19) plan_id FK \"NOT NULL, 订阅计划ID\"\n        VARCHAR(50) quota_type \"NOT NULL, 配额类型（repository/diagram/sql_parse/ai_generate）\"\n        INT(10) quota_limit \"NOT NULL, 配额限制（-1表示无限制）\"\n        VARCHAR(20) reset_cycle \"重置周期（daily/monthly/yearly/never）\"\n        TEXT(65535) description \"配额描述\"\n        DATETIME(19) create_time \"创建时间\"\n        DATETIME(19) update_time \"更新时间\"\n    }\n    biz_project_config {\n        BIGINT(19) id PK \"配置ID\"\n        BIGINT(19) project_id \"NOT NULL, 项目ID\"\n        VARCHAR(20) config_type \"NOT NULL, 配置类型（SQL/JDBC）\"\n        MEDIUMTEXT(16777215) sql_content \"SQL内容\"\n        VARCHAR(500) jdbc_url \"JDBC URL\"\n        VARCHAR(100) jdbc_username \"数据库用户名\"\n        VARCHAR(255) jdbc_password \"数据库密码（AES加密）\"\n        VARCHAR(100) schema_name \"Schema名称\"\n        JSON(1073741824) render_options \"渲染选项（JSON格式）\"\n        DATETIME(19) create_time \"创建时间\"\n    }\n    biz_project_version {\n        BIGINT(19) id PK \"版本ID\"\n        BIGINT(19) project_id \"NOT NULL, 项目ID\"\n        INT(10) version_no \"NOT NULL, 版本号\"\n        TEXT(65535) mermaid_code \"Mermaid源码\"\n        TEXT(65535) change_log \"变更日志\"\n        DATETIME(19) create_time \"创建时间\"\n    }\n    biz_repository {\n        BIGINT(19) id PK \"项目ID\"\n        BIGINT(19) user_id FK \"NOT NULL, 用户ID\"\n        VARCHAR(100) repository_name \"NOT NULL, 架构库名称\"\n        TEXT(65535) description \"项目描述\"\n        INT(10) diagram_count \"架构图数量\"\n        VARCHAR(20) status \"状态（DRAFT/PUBLISHED）\"\n        BIT(1) is_team_repository \"是否为团队归档库\"\n        DATETIME(19) create_time \"创建时间\"\n        DATETIME(19) update_time \"更新时间\"\n    }\n    biz_subscription_plan {\n        BIGINT(19) id PK \"计划ID\"\n        VARCHAR(50) plan_code \"NOT NULL, 计划代码（FREE/PRO/TEAM）\"\n        VARCHAR(100) plan_name \"NOT NULL, 计划名称\"\n        VARCHAR(100) plan_name_en \"计划英文名称\"\n        TEXT(65535) description \"计划描述\"\n        DECIMAL(10_2) price_monthly \"月付价格\"\n        DECIMAL(10_2) price_yearly \"年付价格\"\n        INT(10) max_repositories \"最大架构库数量（-1表示无限制）\"\n        INT(10) max_diagrams_per_repo \"每个库最大架构图数量（-1表示无限制）\"\n        INT(10) max_sql_size_mb \"最大SQL文件大小（MB）\"\n        TINYINT(3) support_jdbc \"是否支持JDBC连接（0=否，1=是）\"\n        TINYINT(3) support_ai \"是否支持AI功能（0=否，1=是）\"\n        TINYINT(3) support_export \"是否支持导出（0=否，1=是）\"\n        TINYINT(3) support_team \"是否支持团队协作（0=否，1=是）\"\n        INT(10) max_teams \"最大团队数量\"\n        INT(10) max_team_members \"每个团队最大成员数\"\n        TINYINT(3) priority_support \"是否优先支持（0=否，1=是）\"\n        JSON(1073741824) features \"功能特性列表（JSON格式）\"\n        INT(10) sort_order \"排序顺序\"\n        VARCHAR(20) status \"状态（active/inactive）\"\n        DATETIME(19) create_time \"创建时间\"\n        DATETIME(19) update_time \"更新时间\"\n    }\n    biz_team {\n        BIGINT(19) id PK \"团队ID\"\n        VARCHAR(100) team_name \"NOT NULL, 团队名称\"\n        VARCHAR(50) team_code \"NOT NULL, 团队唯一标识\"\n        TEXT(65535) description \"团队描述\"\n        VARCHAR(500) avatar_url \"团队头像\"\n        BIGINT(19) owner_id \"NOT NULL, 所有者ID\"\n        BIGINT(19) repository_id \"NOT NULL, 绑定的架构归档库ID\"\n        INT(10) member_count \"成员数量\"\n        INT(10) max_members \"最大成员数（根据订阅套餐）\"\n        VARCHAR(20) status \"状态: active-活跃, suspended-暂停, deleted-已删除\"\n        DATETIME(19) create_time \"创建时间\"\n        DATETIME(19) update_time \"更新时间\"\n    }\n    biz_team_invitation {\n        BIGINT(19) id PK \"邀请ID\"\n        BIGINT(19) team_id \"NOT NULL, 团队ID\"\n        VARCHAR(50) invite_code \"NOT NULL, 邀请码（UUID）\"\n        VARCHAR(500) invite_url \"NOT NULL, 完整邀请链接\"\n        BIGINT(19) creator_id \"NOT NULL, 创建人ID\"\n        INT(10) max_uses \"最大使用次数（0=无限制）\"\n        INT(10) used_count \"已使用次数\"\n        VARCHAR(20) status \"状态: active-有效, disabled-禁用, expired-已过期\"\n        DATETIME(19) expire_time \"过期时间（NULL=永久有效）\"\n        DATETIME(19) create_time \"创建时间\"\n        DATETIME(19) update_time \"更新时间\"\n    }\n    biz_team_invitation_log {\n        BIGINT(19) id PK \"记录ID\"\n        BIGINT(19) team_id \"NOT NULL, 团队ID\"\n        VARCHAR(50) invite_code \"NOT NULL, 邀请码\"\n        BIGINT(19) user_id \"NOT NULL, 加入用户ID\"\n        VARCHAR(50) username \"用户名\"\n        VARCHAR(100) email \"邮箱\"\n        BIT(1) is_new_user \"是否新注册用户\"\n        DATETIME(19) join_time \"加入时间\"\n        VARCHAR(50) ip_address \"IP地址\"\n        VARCHAR(500) user_agent \"用户代理\"\n    }\n    biz_team_log {\n        BIGINT(19) id PK \"日志ID\"\n        BIGINT(19) team_id \"NOT NULL, 团队ID\"\n        BIGINT(19) user_id \"NOT NULL, 操作人ID\"\n        VARCHAR(50) action \"NOT NULL, 操作类型\"\n        VARCHAR(50) target_type \"目标类型: member-成员, diagram-架构图, team-团队\"\n        BIGINT(19) target_id \"目标ID\"\n        TEXT(65535) description \"操作描述\"\n        VARCHAR(50) ip_address \"IP地址\"\n        VARCHAR(500) user_agent \"用户代理\"\n        DATETIME(19) create_time \"创建时间\"\n    }\n    biz_team_member {\n        BIGINT(19) id PK \"成员ID\"\n        BIGINT(19) team_id \"NOT NULL, 团队ID\"\n        BIGINT(19) user_id \"NOT NULL, 用户ID\"\n        VARCHAR(20) role \"NOT NULL, 角色: owner-所有者, member-成员\"\n        VARCHAR(50) nickname \"团队内昵称\"\n        DATETIME(19) join_time \"加入时间\"\n        VARCHAR(20) join_source \"加入方式: create-创建, invite-邀请\"\n        VARCHAR(50) invite_code \"使用的邀请码\"\n        VARCHAR(20) status \"状态: active-活跃, inactive-停用\"\n        DATETIME(19) create_time \"创建时间\"\n        DATETIME(19) update_time \"更新时间\"\n    }\n    biz_user_quota_tracking {\n        BIGINT(19) id PK \"跟踪ID\"\n        BIGINT(19) user_id FK \"NOT NULL, 用户ID\"\n        BIGINT(19) plan_quota_id FK \"NOT NULL, 计划配额ID\"\n        VARCHAR(50) quota_type \"NOT NULL, 配额类型\"\n        INT(10) quota_limit \"NOT NULL, 当前配额限制\"\n        INT(10) quota_used \"已使用配额\"\n        DATETIME(19) last_reset_time \"上次重置时间\"\n        DATETIME(19) create_time \"创建时间\"\n        DATETIME(19) update_time \"更新时间\"\n    }\n    biz_user_subscription {\n        BIGINT(19) id PK \"订阅ID\"\n        BIGINT(19) user_id FK \"NOT NULL, 用户ID\"\n        BIGINT(19) plan_id FK \"NOT NULL, 计划ID\"\n        VARCHAR(50) plan_code \"NOT NULL, 计划代码\"\n        BIGINT(19) payment_order_id FK \"支付订单ID\"\n        VARCHAR(20) billing_cycle \"计费周期（monthly/yearly）\"\n        DECIMAL(10_2) price \"订阅价格\"\n        DATETIME(19) start_time \"NOT NULL, 开始时间\"\n        DATETIME(19) end_time \"NOT NULL, 结束时间\"\n        TINYINT(3) auto_renew \"是否自动续费（0=否，1=是）\"\n        VARCHAR(20) status \"状态（active/expired/cancelled）\"\n        VARCHAR(50) payment_method \"支付方式（wechat/alipay/stripe）\"\n        VARCHAR(100) transaction_id \"交易ID\"\n        DATETIME(19) cancel_time \"取消时间\"\n        TEXT(65535) cancel_reason \"取消原因\"\n        DATETIME(19) create_time \"创建时间\"\n        DATETIME(19) update_time \"更新时间\"\n    }\n    sys_config {\n        BIGINT(19) id PK \"配置ID\"\n        VARCHAR(100) config_key \"NOT NULL, 配置键（唯一）\"\n        TEXT(65535) config_value \"配置值\"\n        VARCHAR(500) description \"描述\"\n        DATETIME(19) create_time \"创建时间\"\n        DATETIME(19) update_time \"更新时间\"\n    }\n    sys_user {\n        BIGINT(19) id PK \"用户ID\"\n        VARCHAR(50) username \"NOT NULL, 用户名（唯一）\"\n        VARCHAR(255) password \"NOT NULL, 密码（BCrypt加密）\"\n        VARCHAR(100) email \"邮箱\"\n        VARCHAR(20) phone \"手机号\"\n        VARCHAR(50) display_name \"显示名称\"\n        VARCHAR(50) job_title \"职位头衔\"\n        VARCHAR(500) avatar_url \"头像URL\"\n        TINYINT(3) status \"状态（1=正常，0=禁用）\"\n        DATETIME(19) create_time \"创建时间\"\n        DATETIME(19) update_time \"更新时间\"\n    }\n    biz_repository ||--o{ biz_diagram : \"repository_id\"\n    sys_user ||--o{ biz_payment_order : \"user_id\"\n    biz_subscription_plan ||--o{ biz_plan_quota : \"plan_id\"\n    sys_user ||--o{ biz_repository : \"user_id\"\n    sys_user ||--o{ biz_user_quota_tracking : \"user_id\"\n    biz_plan_quota ||--o{ biz_user_quota_tracking : \"plan_quota_id\"\n    biz_payment_order ||--o{ biz_user_subscription : \"payment_order_id\"\n    biz_subscription_plan ||--o{ biz_user_subscription : \"plan_id\"\n    sys_user ||--o{ biz_user_subscription : \"user_id\"\n', '初始版本', '2026-02-10 18:49:11');
INSERT INTO `biz_project_version` VALUES (3, 20, 1, 'erDiagram\n    workspace {\n        BIGINT id PK \"主键ID\"\n        VARCHAR(100) name \"NOT NULL, 工作空间名称\"\n        TEXT description \"工作空间描述\"\n        BIGINT owner_id \"NOT NULL, 创建者用户ID（外部系统用户）\"\n        VARCHAR(500) avatar_url \"头像URL\"\n        TINYINT(1) is_archived \"NOT NULL, 是否归档：0-否，1-是\"\n        DATETIME created_at \"NOT NULL, 创建时间\"\n        DATETIME updated_at \"NOT NULL, 更新时间\"\n    }\n    member {\n        BIGINT id PK \"主键ID\"\n        BIGINT workspace_id FK \"NOT NULL, 所属工作空间ID\"\n        BIGINT user_id \"NOT NULL, 用户ID（外部系统用户）\"\n        VARCHAR(50) nickname \"在工作空间中的昵称\"\n        ENUM role \"NOT NULL, 角色：owner-所有者，admin-管理员，member-普通成员\"\n        DATETIME joined_at \"NOT NULL, 加入时间\"\n        TINYINT(1) is_active \"NOT NULL, 是否有效：0-已移除，1-有效\"\n        DATETIME created_at \"NOT NULL, 创建时间\"\n        DATETIME updated_at \"NOT NULL, 更新时间\"\n    }\n    project {\n        BIGINT id PK \"主键ID\"\n        BIGINT workspace_id FK \"NOT NULL, 所属工作空间ID\"\n        VARCHAR(100) name \"NOT NULL, 项目名称\"\n        TEXT description \"项目描述\"\n        VARCHAR(500) cover_url \"封面图片URL\"\n        DATE start_date \"计划开始日期\"\n        DATE end_date \"计划结束日期\"\n        ENUM status \"NOT NULL, 状态\"\n        ENUM visibility \"NOT NULL, 可见性\"\n        INT sort_order \"NOT NULL, 排序权重\"\n        BIGINT created_by FK \"NOT NULL, 创建者成员ID\"\n        DATETIME created_at \"NOT NULL, 创建时间\"\n        DATETIME updated_at \"NOT NULL, 更新时间\"\n    }\n    project_member {\n        BIGINT id PK \"主键ID\"\n        BIGINT project_id FK \"NOT NULL, 项目ID\"\n        BIGINT member_id FK \"NOT NULL, 成员ID\"\n        ENUM role \"NOT NULL, 项目内角色\"\n        DATETIME joined_at \"NOT NULL, 加入时间\"\n        DATETIME created_at \"NOT NULL, 创建时间\"\n    }\n    board {\n        BIGINT id PK \"主键ID\"\n        BIGINT project_id FK \"NOT NULL, 所属项目ID\"\n        VARCHAR(100) name \"NOT NULL, 看板名称\"\n        TEXT description \"看板描述\"\n        ENUM layout_type \"NOT NULL, 布局类型\"\n        TINYINT(1) is_default \"NOT NULL, 是否为默认看板\"\n        INT sort_order \"NOT NULL, 排序权重\"\n        JSON filter_config \"筛选配置（JSON格式）\"\n        BIGINT created_by FK \"NOT NULL, 创建者成员ID\"\n        DATETIME created_at \"NOT NULL, 创建时间\"\n        DATETIME updated_at \"NOT NULL, 更新时间\"\n    }\n    list {\n        BIGINT id PK \"主键ID\"\n        BIGINT board_id FK \"NOT NULL, 所属看板ID\"\n        VARCHAR(100) name \"NOT NULL, 列表名称\"\n        VARCHAR(20) color \"颜色标识\"\n        INT wip_limit \"在制品限制（Work In Progress Limit）\"\n        TINYINT(1) is_archive_list \"NOT NULL, 是否为归档列表\"\n        INT sort_order \"NOT NULL, 排序权重\"\n        DATETIME created_at \"NOT NULL, 创建时间\"\n        DATETIME updated_at \"NOT NULL, 更新时间\"\n    }\n    workspace ||--o{ member : \"workspace_id\"\n    workspace ||--o{ project : \"workspace_id\"\n    member ||--o{ project : \"created_by\"\n    project ||--o{ project_member : \"project_id\"\n    member ||--o{ project_member : \"member_id\"\n    project ||--o{ board : \"project_id\"\n    member ||--o{ board : \"created_by\"\n    board ||--o{ list : \"board_id\"', '初始版本', '2026-02-10 19:20:29');

-- ----------------------------
-- Table structure for biz_repository
-- ----------------------------
DROP TABLE IF EXISTS `biz_repository`;
CREATE TABLE `biz_repository`  (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '项目ID',
  `user_id` bigint NOT NULL COMMENT '用户ID',
  `repository_name` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL COMMENT '架构库名称',
  `description` text CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL COMMENT '项目描述',
  `diagram_count` int NULL DEFAULT 0 COMMENT '架构图数量',
  `status` varchar(20) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL DEFAULT 'DRAFT' COMMENT '状态（DRAFT/PUBLISHED）',
  `is_team_repository` tinyint(1) NULL DEFAULT 0 COMMENT '是否为团队归档库',
  `create_time` datetime NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` datetime NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`) USING BTREE,
  INDEX `idx_user_id`(`user_id` ASC) USING BTREE,
  INDEX `idx_status`(`status` ASC) USING BTREE,
  INDEX `idx_create_time`(`create_time` ASC) USING BTREE,
  INDEX `idx_user_status`(`user_id` ASC, `status` ASC) USING BTREE,
  CONSTRAINT `fk_project_user` FOREIGN KEY (`user_id`) REFERENCES `sys_user` (`id`) ON DELETE CASCADE ON UPDATE RESTRICT
) ENGINE = InnoDB AUTO_INCREMENT = 21 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_unicode_ci COMMENT = '项目表' ROW_FORMAT = Dynamic;

-- ----------------------------
-- Records of biz_repository
-- ----------------------------
INSERT INTO `biz_repository` VALUES (7, 1, '架构可视化E-R图', '', 7, 'active', 1, '2026-02-08 13:32:24', '2026-02-11 16:20:45');
INSERT INTO `biz_repository` VALUES (13, 1, 'd', '', 0, 'active', 0, '2026-02-10 11:52:03', '2026-02-10 11:52:03');
INSERT INTO `biz_repository` VALUES (19, 1, 'cs ', '', 0, 'active', 0, '2026-02-10 18:49:11', '2026-02-10 18:49:11');
INSERT INTO `biz_repository` VALUES (20, 1, '项目管理系统', '', 4, 'active', 0, '2026-02-10 19:20:29', '2026-02-11 16:26:31');

-- ----------------------------
-- Table structure for biz_subscription_plan
-- ----------------------------
DROP TABLE IF EXISTS `biz_subscription_plan`;
CREATE TABLE `biz_subscription_plan`  (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '计划ID',
  `plan_code` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL COMMENT '计划代码（FREE/PRO/TEAM）',
  `plan_name` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL COMMENT '计划名称',
  `plan_name_en` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL DEFAULT NULL COMMENT '计划英文名称',
  `description` text CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL COMMENT '计划描述',
  `price_monthly` decimal(10, 2) NULL DEFAULT 0.00 COMMENT '月付价格',
  `price_yearly` decimal(10, 2) NULL DEFAULT 0.00 COMMENT '年付价格',
  `max_repositories` int NULL DEFAULT -1 COMMENT '最大架构库数量（-1表示无限制）',
  `max_diagrams_per_repo` int NULL DEFAULT -1 COMMENT '每个库最大架构图数量（-1表示无限制）',
  `max_sql_size_mb` int NULL DEFAULT 10 COMMENT '最大SQL文件大小（MB）',
  `support_jdbc` tinyint NULL DEFAULT 0 COMMENT '是否支持JDBC连接（0=否，1=是）',
  `support_ai` tinyint NULL DEFAULT 0 COMMENT '是否支持AI功能（0=否，1=是）',
  `support_export` tinyint NULL DEFAULT 1 COMMENT '是否支持导出（0=否，1=是）',
  `support_team` tinyint NULL DEFAULT 0 COMMENT '是否支持团队协作（0=否，1=是）',
  `max_teams` int NULL DEFAULT 0 COMMENT '最大团队数量',
  `max_team_members` int NULL DEFAULT 0 COMMENT '每个团队最大成员数',
  `priority_support` tinyint NULL DEFAULT 0 COMMENT '是否优先支持（0=否，1=是）',
  `features` json NULL COMMENT '功能特性列表（JSON格式）',
  `sort_order` int NULL DEFAULT 0 COMMENT '排序顺序',
  `status` varchar(20) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL DEFAULT 'active' COMMENT '状态（active/inactive）',
  `create_time` datetime NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` datetime NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`) USING BTREE,
  UNIQUE INDEX `uk_plan_code`(`plan_code` ASC) USING BTREE,
  INDEX `idx_status`(`status` ASC) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 4 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_unicode_ci COMMENT = '订阅计划表' ROW_FORMAT = DYNAMIC;

-- ----------------------------
-- Records of biz_subscription_plan
-- ----------------------------
INSERT INTO `biz_subscription_plan` VALUES (1, 'FREE', '社区版', 'Community', '适合个人开发者和小型项目使用', 0.00, 0.00, 3, 10, 5, 0, 0, 1, 0, 0, 0, 0, '[\"3个架构库\", \"10次架构图/月\", \"50次SQL解析/月\", \"基础ER图生成\", \"MySQL支持\", \"社区支持\"]', 1, 'active', '2026-02-08 14:16:32', '2026-02-10 13:07:08');
INSERT INTO `biz_subscription_plan` VALUES (2, 'PRO', '专业版', 'Professional', '适合开发者和生产力工具使用', 29.00, 290.00, 20, 500, 50, 1, 1, 1, 0, 0, 0, 0, '[\"20个架构库\", \"500次架构图/月\", \"1000次SQL解析/月\", \"100次AI生成/月\", \"多数据库支持\", \"JDBC实时连接\", \"高清导出\", \"优先支持\"]', 2, 'active', '2026-02-08 14:16:32', '2026-02-10 13:06:45');
INSERT INTO `biz_subscription_plan` VALUES (3, 'TEAM', '团队版', 'Team', '适合企业团队协作使用', 99.00, 990.00, -1, -1, 200, 1, 1, 1, 1, 1, 10, 1, '[\"无限架构库\", \"无限架构图\", \"无限SQL解析\", \"1000次AI生成/月\", \"团队协作\", \"版本控制\", \"API集成\", \"私有部署\", \"专属支持\"]', 3, 'active', '2026-02-08 14:16:32', '2026-02-10 12:19:31');

-- ----------------------------
-- Table structure for biz_team
-- ----------------------------
DROP TABLE IF EXISTS `biz_team`;
CREATE TABLE `biz_team`  (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '团队ID',
  `team_name` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NOT NULL COMMENT '团队名称',
  `team_code` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NOT NULL COMMENT '团队唯一标识',
  `description` text CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NULL COMMENT '团队描述',
  `avatar_url` varchar(500) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NULL DEFAULT NULL COMMENT '团队头像',
  `owner_id` bigint NOT NULL COMMENT '所有者ID',
  `repository_id` bigint NOT NULL COMMENT '绑定的架构归档库ID',
  `member_count` int NULL DEFAULT 1 COMMENT '成员数量',
  `max_members` int NULL DEFAULT 10 COMMENT '最大成员数（根据订阅套餐）',
  `status` varchar(20) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NULL DEFAULT 'active' COMMENT '状态: active-活跃, suspended-暂停, deleted-已删除',
  `create_time` datetime NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` datetime NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`) USING BTREE,
  UNIQUE INDEX `uk_team_code`(`team_code` ASC) USING BTREE,
  UNIQUE INDEX `uk_repository_id`(`repository_id` ASC) USING BTREE,
  INDEX `idx_owner_id`(`owner_id` ASC) USING BTREE,
  INDEX `idx_status`(`status` ASC) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 2 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_0900_ai_ci COMMENT = '团队表' ROW_FORMAT = Dynamic;

-- ----------------------------
-- Records of biz_team
-- ----------------------------
INSERT INTO `biz_team` VALUES (1, '测试', 'TEAM_1770700953662_3685', '', NULL, 1, 7, 2, 10, 'active', '2026-02-10 13:22:34', '2026-02-11 15:21:25');

-- ----------------------------
-- Table structure for biz_team_invitation
-- ----------------------------
DROP TABLE IF EXISTS `biz_team_invitation`;
CREATE TABLE `biz_team_invitation`  (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '邀请ID',
  `team_id` bigint NOT NULL COMMENT '团队ID',
  `invite_code` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NOT NULL COMMENT '邀请码（UUID）',
  `invite_url` varchar(500) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NOT NULL COMMENT '完整邀请链接',
  `creator_id` bigint NOT NULL COMMENT '创建人ID',
  `max_uses` int NULL DEFAULT 0 COMMENT '最大使用次数（0=无限制）',
  `used_count` int NULL DEFAULT 0 COMMENT '已使用次数',
  `status` varchar(20) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NULL DEFAULT 'active' COMMENT '状态: active-有效, disabled-禁用, expired-已过期',
  `expire_time` datetime NULL DEFAULT NULL COMMENT '过期时间（NULL=永久有效）',
  `create_time` datetime NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` datetime NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`) USING BTREE,
  UNIQUE INDEX `uk_invite_code`(`invite_code` ASC) USING BTREE,
  INDEX `idx_team_id`(`team_id` ASC) USING BTREE,
  INDEX `idx_status`(`status` ASC) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 3 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_0900_ai_ci COMMENT = '团队邀请链接表' ROW_FORMAT = Dynamic;

-- ----------------------------
-- Records of biz_team_invitation
-- ----------------------------
INSERT INTO `biz_team_invitation` VALUES (1, 1, '2238df34b218468ab55d205c23fbe8e9', 'https://coffeeviz.com/team/join/2238df34b218468ab55d205c23fbe8e9', 1, 10, 0, 'disabled', NULL, '2026-02-10 13:24:53', '2026-02-10 18:17:33');
INSERT INTO `biz_team_invitation` VALUES (2, 1, '30a9c691a91142279be2e1fa97535b46', 'https://coffeeviz.com/team/join/30a9c691a91142279be2e1fa97535b46', 1, 2, 2, 'active', NULL, '2026-02-11 14:04:26', '2026-02-11 15:20:56');

-- ----------------------------
-- Table structure for biz_team_invitation_log
-- ----------------------------
DROP TABLE IF EXISTS `biz_team_invitation_log`;
CREATE TABLE `biz_team_invitation_log`  (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '记录ID',
  `team_id` bigint NOT NULL COMMENT '团队ID',
  `invite_code` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NOT NULL COMMENT '邀请码',
  `user_id` bigint NOT NULL COMMENT '加入用户ID',
  `username` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NULL DEFAULT NULL COMMENT '用户名',
  `email` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NULL DEFAULT NULL COMMENT '邮箱',
  `is_new_user` tinyint(1) NULL DEFAULT 0 COMMENT '是否新注册用户',
  `join_time` datetime NULL DEFAULT CURRENT_TIMESTAMP COMMENT '加入时间',
  `ip_address` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NULL DEFAULT NULL COMMENT 'IP地址',
  `user_agent` varchar(500) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NULL DEFAULT NULL COMMENT '用户代理',
  PRIMARY KEY (`id`) USING BTREE,
  INDEX `idx_team_id`(`team_id` ASC) USING BTREE,
  INDEX `idx_invite_code`(`invite_code` ASC) USING BTREE,
  INDEX `idx_user_id`(`user_id` ASC) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 3 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_0900_ai_ci COMMENT = '邀请使用记录表' ROW_FORMAT = Dynamic;

-- ----------------------------
-- Records of biz_team_invitation_log
-- ----------------------------
INSERT INTO `biz_team_invitation_log` VALUES (1, 1, '30a9c691a91142279be2e1fa97535b46', 5, '测试加入团队', '2525363658@qq.com', 1, '2026-02-11 14:08:35', '0:0:0:0:0:0:0:1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36');
INSERT INTO `biz_team_invitation_log` VALUES (2, 1, '30a9c691a91142279be2e1fa97535b46', 6, '测试订阅', '2323565689@qq.com', 1, '2026-02-11 15:20:56', '0:0:0:0:0:0:0:1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36');

-- ----------------------------
-- Table structure for biz_team_log
-- ----------------------------
DROP TABLE IF EXISTS `biz_team_log`;
CREATE TABLE `biz_team_log`  (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '日志ID',
  `team_id` bigint NOT NULL COMMENT '团队ID',
  `user_id` bigint NOT NULL COMMENT '操作人ID',
  `action` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NOT NULL COMMENT '操作类型',
  `target_type` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NULL DEFAULT NULL COMMENT '目标类型: member-成员, diagram-架构图, team-团队',
  `target_id` bigint NULL DEFAULT NULL COMMENT '目标ID',
  `description` text CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NULL COMMENT '操作描述',
  `ip_address` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NULL DEFAULT NULL COMMENT 'IP地址',
  `user_agent` varchar(500) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NULL DEFAULT NULL COMMENT '用户代理',
  `create_time` datetime NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  PRIMARY KEY (`id`) USING BTREE,
  INDEX `idx_team_id`(`team_id` ASC) USING BTREE,
  INDEX `idx_user_id`(`user_id` ASC) USING BTREE,
  INDEX `idx_create_time`(`create_time` ASC) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 8 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_0900_ai_ci COMMENT = '团队操作日志表' ROW_FORMAT = Dynamic;

-- ----------------------------
-- Records of biz_team_log
-- ----------------------------
INSERT INTO `biz_team_log` VALUES (1, 1, 1, 'create_team', 'team', 1, '创建团队: 测试', NULL, NULL, '2026-02-10 13:22:34');
INSERT INTO `biz_team_log` VALUES (2, 1, 1, 'create_invite', 'invitation', 1, '创建邀请链接', NULL, NULL, '2026-02-10 13:24:53');
INSERT INTO `biz_team_log` VALUES (3, 1, 1, 'disable_invite', 'invitation', 1, '禁用邀请链接', NULL, NULL, '2026-02-10 18:17:33');
INSERT INTO `biz_team_log` VALUES (4, 1, 1, 'create_invite', 'invitation', 2, '创建邀请链接', NULL, NULL, '2026-02-11 14:04:26');
INSERT INTO `biz_team_log` VALUES (5, 1, 5, 'register_and_join', 'member', 2, '注册并加入团队', '0:0:0:0:0:0:0:1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36', '2026-02-11 14:08:35');
INSERT INTO `biz_team_log` VALUES (6, 1, 6, 'register_and_join', 'member', 3, '注册并加入团队', '0:0:0:0:0:0:0:1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36', '2026-02-11 15:20:56');
INSERT INTO `biz_team_log` VALUES (7, 1, 1, 'remove_member', 'member', 2, '移除成员: 5', NULL, NULL, '2026-02-11 15:21:25');

-- ----------------------------
-- Table structure for biz_team_member
-- ----------------------------
DROP TABLE IF EXISTS `biz_team_member`;
CREATE TABLE `biz_team_member`  (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '成员ID',
  `team_id` bigint NOT NULL COMMENT '团队ID',
  `user_id` bigint NOT NULL COMMENT '用户ID',
  `role` varchar(20) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NOT NULL DEFAULT 'member' COMMENT '角色: owner-所有者, member-成员',
  `nickname` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NULL DEFAULT NULL COMMENT '团队内昵称',
  `join_time` datetime NULL DEFAULT CURRENT_TIMESTAMP COMMENT '加入时间',
  `join_source` varchar(20) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NULL DEFAULT 'invite' COMMENT '加入方式: create-创建, invite-邀请',
  `invite_code` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NULL DEFAULT NULL COMMENT '使用的邀请码',
  `status` varchar(20) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NULL DEFAULT 'active' COMMENT '状态: active-活跃, inactive-停用',
  `create_time` datetime NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` datetime NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`) USING BTREE,
  UNIQUE INDEX `uk_team_user`(`team_id` ASC, `user_id` ASC) USING BTREE,
  INDEX `idx_user_id`(`user_id` ASC) USING BTREE,
  INDEX `idx_team_id`(`team_id` ASC) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 4 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_0900_ai_ci COMMENT = '团队成员表' ROW_FORMAT = Dynamic;

-- ----------------------------
-- Records of biz_team_member
-- ----------------------------
INSERT INTO `biz_team_member` VALUES (1, 1, 1, 'owner', NULL, '2026-02-10 13:22:34', 'create', NULL, 'active', '2026-02-10 13:22:34', '2026-02-10 13:22:34');
INSERT INTO `biz_team_member` VALUES (2, 1, 5, 'member', NULL, '2026-02-11 14:08:35', 'invite', '30a9c691a91142279be2e1fa97535b46', 'inactive', '2026-02-11 14:08:35', '2026-02-11 15:21:25');
INSERT INTO `biz_team_member` VALUES (3, 1, 6, 'member', NULL, '2026-02-11 15:20:56', 'invite', '30a9c691a91142279be2e1fa97535b46', 'active', '2026-02-11 15:20:56', '2026-02-11 15:20:56');

-- ----------------------------
-- Table structure for biz_user_quota_tracking
-- ----------------------------
DROP TABLE IF EXISTS `biz_user_quota_tracking`;
CREATE TABLE `biz_user_quota_tracking`  (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '跟踪ID',
  `user_id` bigint NOT NULL COMMENT '用户ID',
  `plan_quota_id` bigint NOT NULL COMMENT '计划配额ID',
  `quota_type` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL COMMENT '配额类型',
  `quota_limit` int NOT NULL COMMENT '当前配额限制',
  `quota_used` int NULL DEFAULT 0 COMMENT '已使用配额',
  `last_reset_time` datetime NULL DEFAULT CURRENT_TIMESTAMP COMMENT '上次重置时间',
  `create_time` datetime NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` datetime NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`) USING BTREE,
  UNIQUE INDEX `uk_user_quota_type`(`user_id` ASC, `quota_type` ASC) USING BTREE,
  INDEX `idx_user_id`(`user_id` ASC) USING BTREE,
  INDEX `idx_plan_quota_id`(`plan_quota_id` ASC) USING BTREE,
  CONSTRAINT `fk_user_quota_plan_quota` FOREIGN KEY (`plan_quota_id`) REFERENCES `biz_plan_quota` (`id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
  CONSTRAINT `fk_user_quota_user` FOREIGN KEY (`user_id`) REFERENCES `sys_user` (`id`) ON DELETE CASCADE ON UPDATE RESTRICT
) ENGINE = InnoDB AUTO_INCREMENT = 25 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_unicode_ci COMMENT = '用户配额使用跟踪表' ROW_FORMAT = Dynamic;

-- ----------------------------
-- Records of biz_user_quota_tracking
-- ----------------------------
INSERT INTO `biz_user_quota_tracking` VALUES (1, 1, 5, 'ai_generate', 100, 34, '2026-02-09 15:30:34', '2026-02-10 17:31:37', '2026-02-10 17:31:37');
INSERT INTO `biz_user_quota_tracking` VALUES (2, 1, 6, 'diagram', 500, 9, '2026-02-09 15:30:34', '2026-02-10 17:31:37', '2026-02-10 17:31:37');
INSERT INTO `biz_user_quota_tracking` VALUES (3, 1, 7, 'repository', 20, 8, '2026-02-09 15:30:34', '2026-02-10 17:31:37', '2026-02-10 17:31:37');
INSERT INTO `biz_user_quota_tracking` VALUES (4, 1, 8, 'sql_parse', 1000, 5, '2026-02-09 15:30:34', '2026-02-10 17:31:37', '2026-02-10 17:31:37');
INSERT INTO `biz_user_quota_tracking` VALUES (5, 2, 1, 'ai_generate', 0, 0, '2026-02-08 17:47:27', '2026-02-10 17:31:37', '2026-02-10 17:31:37');
INSERT INTO `biz_user_quota_tracking` VALUES (6, 2, 2, 'diagram', 10, 0, '2026-02-08 14:16:32', '2026-02-10 17:31:37', '2026-02-10 17:31:37');
INSERT INTO `biz_user_quota_tracking` VALUES (7, 2, 3, 'repository', 3, 0, '2026-02-08 14:16:32', '2026-02-10 17:31:37', '2026-02-10 17:31:37');
INSERT INTO `biz_user_quota_tracking` VALUES (8, 2, 4, 'sql_parse', 50, 0, '2026-02-08 17:47:27', '2026-02-10 17:31:37', '2026-02-10 17:31:37');
INSERT INTO `biz_user_quota_tracking` VALUES (9, 3, 1, 'ai_generate', 0, 0, '2026-02-08 17:47:27', '2026-02-10 17:31:37', '2026-02-10 17:31:37');
INSERT INTO `biz_user_quota_tracking` VALUES (10, 3, 2, 'diagram', 10, 0, '2026-02-08 14:16:32', '2026-02-10 17:31:37', '2026-02-10 17:31:37');
INSERT INTO `biz_user_quota_tracking` VALUES (11, 3, 3, 'repository', 3, 0, '2026-02-08 14:16:32', '2026-02-10 17:31:37', '2026-02-10 17:31:37');
INSERT INTO `biz_user_quota_tracking` VALUES (12, 3, 4, 'sql_parse', 50, 0, '2026-02-08 17:47:27', '2026-02-10 17:31:37', '2026-02-10 17:31:37');
INSERT INTO `biz_user_quota_tracking` VALUES (13, 4, 1, 'ai_generate', 0, 0, '2026-02-08 17:47:27', '2026-02-10 17:31:37', '2026-02-10 17:31:37');
INSERT INTO `biz_user_quota_tracking` VALUES (14, 4, 2, 'diagram', 10, 0, '2026-02-08 14:16:32', '2026-02-10 17:31:37', '2026-02-10 17:31:37');
INSERT INTO `biz_user_quota_tracking` VALUES (15, 4, 3, 'repository', 3, 0, '2026-02-08 14:16:32', '2026-02-10 17:31:37', '2026-02-10 17:31:37');
INSERT INTO `biz_user_quota_tracking` VALUES (16, 4, 4, 'sql_parse', 50, 0, '2026-02-08 17:47:27', '2026-02-10 17:31:37', '2026-02-10 17:31:37');
INSERT INTO `biz_user_quota_tracking` VALUES (17, 5, 1, 'ai_generate', 0, 0, '2026-02-11 14:08:35', '2026-02-11 14:08:35', '2026-02-11 14:08:35');
INSERT INTO `biz_user_quota_tracking` VALUES (18, 5, 2, 'diagram', 10, 0, '2026-02-11 14:08:35', '2026-02-11 14:08:35', '2026-02-11 14:08:35');
INSERT INTO `biz_user_quota_tracking` VALUES (19, 5, 3, 'repository', 3, 0, '2026-02-11 14:08:35', '2026-02-11 14:08:35', '2026-02-11 14:08:35');
INSERT INTO `biz_user_quota_tracking` VALUES (20, 5, 4, 'sql_parse', 50, 0, '2026-02-11 14:08:35', '2026-02-11 14:08:35', '2026-02-11 14:08:35');
INSERT INTO `biz_user_quota_tracking` VALUES (21, 6, 23, 'ai_generate', 100, 0, '2026-02-11 15:20:56', '2026-02-11 15:20:56', '2026-02-11 15:20:56');
INSERT INTO `biz_user_quota_tracking` VALUES (22, 6, 21, 'diagram', 500, 0, '2026-02-11 15:20:56', '2026-02-11 15:20:56', '2026-02-11 15:20:56');
INSERT INTO `biz_user_quota_tracking` VALUES (23, 6, 20, 'repository', 20, 0, '2026-02-11 15:20:56', '2026-02-11 15:20:56', '2026-02-11 15:20:56');
INSERT INTO `biz_user_quota_tracking` VALUES (24, 6, 22, 'sql_parse', 1000, 0, '2026-02-11 15:20:56', '2026-02-11 15:20:56', '2026-02-11 15:20:56');

-- ----------------------------
-- Table structure for biz_user_subscription
-- ----------------------------
DROP TABLE IF EXISTS `biz_user_subscription`;
CREATE TABLE `biz_user_subscription`  (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '订阅ID',
  `user_id` bigint NOT NULL COMMENT '用户ID',
  `plan_id` bigint NOT NULL COMMENT '计划ID',
  `plan_code` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL COMMENT '计划代码',
  `payment_order_id` bigint NULL DEFAULT NULL COMMENT '支付订单ID',
  `billing_cycle` varchar(20) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL DEFAULT 'monthly' COMMENT '计费周期（monthly/yearly）',
  `price` decimal(10, 2) NULL DEFAULT 0.00 COMMENT '订阅价格',
  `start_time` datetime NOT NULL COMMENT '开始时间',
  `end_time` datetime NOT NULL COMMENT '结束时间',
  `auto_renew` tinyint NULL DEFAULT 0 COMMENT '是否自动续费（0=否，1=是）',
  `status` varchar(20) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL DEFAULT 'active' COMMENT '状态（active/expired/cancelled）',
  `payment_method` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL DEFAULT NULL COMMENT '支付方式（wechat/alipay/stripe）',
  `transaction_id` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL DEFAULT NULL COMMENT '交易ID',
  `cancel_time` datetime NULL DEFAULT NULL COMMENT '取消时间',
  `cancel_reason` text CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL COMMENT '取消原因',
  `create_time` datetime NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` datetime NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`) USING BTREE,
  INDEX `idx_user_id`(`user_id` ASC) USING BTREE,
  INDEX `idx_plan_id`(`plan_id` ASC) USING BTREE,
  INDEX `idx_status`(`status` ASC) USING BTREE,
  INDEX `idx_end_time`(`end_time` ASC) USING BTREE,
  INDEX `idx_payment_order_id`(`payment_order_id` ASC) USING BTREE,
  CONSTRAINT `fk_subscription_payment` FOREIGN KEY (`payment_order_id`) REFERENCES `biz_payment_order` (`id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
  CONSTRAINT `fk_subscription_plan` FOREIGN KEY (`plan_id`) REFERENCES `biz_subscription_plan` (`id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
  CONSTRAINT `fk_subscription_user` FOREIGN KEY (`user_id`) REFERENCES `sys_user` (`id`) ON DELETE CASCADE ON UPDATE RESTRICT
) ENGINE = InnoDB AUTO_INCREMENT = 9 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_unicode_ci COMMENT = '用户订阅表' ROW_FORMAT = DYNAMIC;

-- ----------------------------
-- Records of biz_user_subscription
-- ----------------------------
INSERT INTO `biz_user_subscription` VALUES (1, 1, 3, 'TEAM', NULL, 'monthly', 99.00, '2026-02-08 14:16:32', '2027-02-09 15:30:34', 0, 'active', NULL, NULL, NULL, NULL, '2026-02-08 14:16:32', '2026-02-10 13:21:53');
INSERT INTO `biz_user_subscription` VALUES (2, 2, 1, 'FREE', NULL, 'monthly', 0.00, '2026-02-08 14:16:32', '2026-03-08 14:16:32', 0, 'active', NULL, NULL, NULL, NULL, '2026-02-08 14:16:32', '2026-02-08 18:42:16');
INSERT INTO `biz_user_subscription` VALUES (3, 3, 1, 'FREE', NULL, 'monthly', 0.00, '2026-02-08 14:16:32', '2026-03-08 14:16:32', 0, 'active', NULL, NULL, NULL, NULL, '2026-02-08 14:16:32', '2026-02-08 18:42:19');
INSERT INTO `biz_user_subscription` VALUES (4, 4, 1, 'FREE', NULL, 'monthly', 0.00, '2026-02-08 14:16:32', '2026-03-08 14:16:32', 0, 'active', NULL, NULL, NULL, NULL, '2026-02-08 14:16:32', '2026-02-08 18:42:21');
INSERT INTO `biz_user_subscription` VALUES (5, 5, 1, 'FREE', NULL, 'monthly', 0.00, '2026-02-11 14:08:35', '2026-03-11 14:08:35', 0, 'cancelled', NULL, NULL, '2026-02-11 15:16:04', '升级到新计划', '2026-02-11 14:08:35', '2026-02-11 14:08:35');
INSERT INTO `biz_user_subscription` VALUES (6, 5, 2, 'PRO', NULL, 'monthly', 29.00, '2026-02-11 15:16:04', '2026-03-11 15:16:04', 0, 'active', NULL, NULL, NULL, NULL, '2026-02-11 15:16:04', '2026-02-11 15:16:04');
INSERT INTO `biz_user_subscription` VALUES (7, 6, 1, 'FREE', NULL, 'monthly', 0.00, '2026-02-11 15:20:56', '2026-03-11 15:20:56', 0, 'cancelled', NULL, NULL, '2026-02-11 15:21:07', '升级到新计划', '2026-02-11 15:20:56', '2026-02-11 15:20:56');
INSERT INTO `biz_user_subscription` VALUES (8, 6, 2, 'PRO', NULL, 'monthly', 29.00, '2026-02-11 15:21:07', '2026-03-11 15:21:07', 0, 'active', NULL, NULL, NULL, NULL, '2026-02-11 15:21:07', '2026-02-11 15:21:07');

-- ----------------------------
-- Table structure for sys_config
-- ----------------------------
DROP TABLE IF EXISTS `sys_config`;
CREATE TABLE `sys_config`  (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '配置ID',
  `config_key` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL COMMENT '配置键（唯一）',
  `config_value` text CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL COMMENT '配置值',
  `description` varchar(500) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL DEFAULT NULL COMMENT '描述',
  `create_time` datetime NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` datetime NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`) USING BTREE,
  UNIQUE INDEX `config_key`(`config_key` ASC) USING BTREE,
  INDEX `idx_config_key`(`config_key` ASC) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 13 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_unicode_ci COMMENT = '系统配置表' ROW_FORMAT = Dynamic;

-- ----------------------------
-- Records of sys_config
-- ----------------------------
INSERT INTO `sys_config` VALUES (1, 'openai.api.key', '*************************', 'OpenAI API密钥', '2026-02-07 11:42:16', '2026-02-09 15:49:32');
INSERT INTO `sys_config` VALUES (2, 'openai.api.base_url', 'https://api-inference.modelscope.cn/v1', 'OpenAI API基础地址', '2026-02-07 11:42:16', '2026-02-07 11:42:16');
INSERT INTO `sys_config` VALUES (3, 'openai.model.name', 'moonshotai/Kimi-K2.5', 'OpenAI模型名称', '2026-02-07 11:42:16', '2026-02-07 11:42:16');
INSERT INTO `sys_config` VALUES (4, 'mermaid.cli.path', 'mmdc', 'Mermaid CLI路径', '2026-02-07 11:42:16', '2026-02-07 11:42:16');
INSERT INTO `sys_config` VALUES (5, 'mermaid.cli.timeout', '10000', 'Mermaid CLI超时时间（毫秒）', '2026-02-07 11:42:16', '2026-02-07 11:42:16');
INSERT INTO `sys_config` VALUES (6, 'export.max.size', '10485760', '导出文件最大大小（字节，默认10MB）', '2026-02-07 11:42:16', '2026-02-07 11:42:16');
INSERT INTO `sys_config` VALUES (7, 'export.temp.dir', '/tmp/coffeeviz', '临时文件目录', '2026-02-07 11:42:16', '2026-02-07 11:42:16');
INSERT INTO `sys_config` VALUES (8, 'sql.max.length', '1000000', 'SQL文本最大长度（字符）', '2026-02-07 11:42:16', '2026-02-07 11:42:16');
INSERT INTO `sys_config` VALUES (9, 'jdbc.connection.timeout', '10', 'JDBC连接超时时间（秒）', '2026-02-07 11:42:16', '2026-02-07 11:42:16');
INSERT INTO `sys_config` VALUES (10, 'jdbc.query.timeout', '30', 'JDBC查询超时时间（秒）', '2026-02-07 11:42:16', '2026-02-07 11:42:16');
INSERT INTO `sys_config` VALUES (11, 'rate.limit.per.second', '10', 'API限流：每秒请求数', '2026-02-07 11:42:16', '2026-02-07 11:42:16');
INSERT INTO `sys_config` VALUES (12, 'cache.expire.seconds', '3600', '缓存过期时间（秒）', '2026-02-07 11:42:16', '2026-02-07 11:42:16');

-- ----------------------------
-- Table structure for sys_user
-- ----------------------------
DROP TABLE IF EXISTS `sys_user`;
CREATE TABLE `sys_user`  (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '用户ID',
  `username` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL COMMENT '用户名（唯一）',
  `password` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL COMMENT '密码（BCrypt加密）',
  `email` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL DEFAULT NULL COMMENT '邮箱',
  `phone` varchar(20) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL DEFAULT NULL COMMENT '手机号',
  `display_name` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL DEFAULT NULL COMMENT '显示名称',
  `job_title` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL DEFAULT NULL COMMENT '职位头衔',
  `avatar_url` varchar(500) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL DEFAULT NULL COMMENT '头像URL',
  `status` tinyint NULL DEFAULT 1 COMMENT '状态（1=正常，0=禁用）',
  `create_time` datetime NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` datetime NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`) USING BTREE,
  UNIQUE INDEX `username`(`username` ASC) USING BTREE,
  INDEX `idx_username`(`username` ASC) USING BTREE,
  INDEX `idx_email`(`email` ASC) USING BTREE,
  INDEX `idx_status`(`status` ASC) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 7 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_unicode_ci COMMENT = '用户表' ROW_FORMAT = Dynamic;

-- ----------------------------
-- Records of sys_user
-- ----------------------------
INSERT INTO `sys_user` VALUES (1, 'admin', '$2a$10$rJrh3nvpyBQ1QDDsTkmIG.nAXiwjTF0lwRHuEQz/JY/DDRpMhO9j.', 'admin@coffeeviz.com', NULL, '系统管理员', 'Administrator', NULL, 1, '2026-02-07 11:42:16', '2026-02-07 13:51:38');
INSERT INTO `sys_user` VALUES (2, '3273495516@qq.com', '$2a$12$Wgmk1lSoAJWlwSDwNMXGQu6ux2k/IUiiEjoGsj9gLvnHuSRJ3Yke.', NULL, NULL, '神阁绘8d67833604', NULL, NULL, 1, '2026-02-07 19:23:26', '2026-02-07 19:45:51');
INSERT INTO `sys_user` VALUES (3, 'user_6154', '$2a$12$Fc2luHllb37KJeAaGTFwy.QcW8ABaD5TKSXmSiy2c4wtmjRVk41qm', NULL, '13272796154', '用户6154', NULL, NULL, 1, '2026-02-07 19:30:56', '2026-02-07 19:30:56');
INSERT INTO `sys_user` VALUES (4, '2703772950@qq.com', '$2a$12$4bnoZcppTnPR3eeaTLG2c.cbkl1UsIYh/2DG5fp0eT.JhCm9j6.c6', 'eighteenthstuai@gmail.com', '13245456565', '神阁绘9e3981fd55', NULL, NULL, 1, '2026-02-07 19:39:43', '2026-02-07 19:39:43');
INSERT INTO `sys_user` VALUES (5, '测试加入团队', '$2a$12$G5Fsc3tM68h/5DHvuIY0yeOw4tL7nHVehtDsZdMcLoUPgtlOVnfHm', '2525363658@qq.com', NULL, '神阁绘f70a27000e', NULL, NULL, 1, '2026-02-11 14:08:35', '2026-02-11 14:08:35');
INSERT INTO `sys_user` VALUES (6, '测试订阅', '$2a$12$SKm/lsg6ejO6W1KY7t27JOv3tS/1eCUcrwJaOaiiCtucqoJ5mdc9m', '2323565689@qq.com', NULL, '神阁绘23d5bedc92', NULL, NULL, 1, '2026-02-11 15:20:55', '2026-02-11 15:20:55');

-- ----------------------------
-- Triggers structure for table biz_diagram
-- ----------------------------
DROP TRIGGER IF EXISTS `trg_diagram_insert`;
delimiter ;;
CREATE TRIGGER `trg_diagram_insert` AFTER INSERT ON `biz_diagram` FOR EACH ROW BEGIN
  UPDATE `biz_repository` 
  SET `diagram_count` = (SELECT COUNT(*) FROM `biz_diagram` WHERE `repository_id` = NEW.repository_id)
  WHERE `id` = NEW.repository_id;
END
;;
delimiter ;

-- ----------------------------
-- Triggers structure for table biz_diagram
-- ----------------------------
DROP TRIGGER IF EXISTS `trg_diagram_delete`;
delimiter ;;
CREATE TRIGGER `trg_diagram_delete` AFTER DELETE ON `biz_diagram` FOR EACH ROW BEGIN
  UPDATE `biz_repository` 
  SET `diagram_count` = (SELECT COUNT(*) FROM `biz_diagram` WHERE `repository_id` = OLD.repository_id)
  WHERE `id` = OLD.repository_id;
END
;;
delimiter ;

SET FOREIGN_KEY_CHECKS = 1;
